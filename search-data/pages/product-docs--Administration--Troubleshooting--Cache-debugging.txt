---
title: "Cache debugging"
url: https://docs.magnolia-cms.com/product-docs/Administration/Troubleshooting/Cache-debugging/
category: Magnolia 6.4
version: latest
breadcrumb: DX Core > Administration > Troubleshooting > Cache debugging
---

# Cache debugging

When customizing the [Cache module](../../../Modules/List-of-modules/Cache-modules/) configuration or using an advanced caching strategy, it can be helpful to have some confirmation things are working as intended. By turning on the debugging features of the cache module, you can verify both cache and flush events.

## [](#_cache_filter)Cache filter

The cache filter is the entry point into cache debugging. To see if an item is being cached, enable `DEBUG` using the [Log Tools app](../../../Apps/List-of-apps/Log-Tools-app/) or adjust the [log4j2](../../Monitoring/Audit/) configuration file. The former is a transient adjustment (resets on restart), while the latter is permanent (survives the restart). Usually, using the app is the preferred approach.

### [](#_enable_filter_debugging)Enable filter debugging

1.  Open the [Log Tools app](../../../Apps/List-of-apps/Log-Tools-app/).

2.  Go to the **Log Levels** tab.

3.  At the bottom of the page, enter the **Logger name**: `info.magnolia.module.cache.filter.CacheFilter`.

4.  Click **Add logger config** and check the entry is added to the list above at `DEBUG` level.


### [](#_debug_requests)Debug requests

With debug enabled, you can begin making some test requests.

Using the travel demo as an example:

> **Note:** The cache behaves differently for author and public instances. For testing purposes, a public instance typically makes the most sense.

1.  Request the page `http://localhost:8080/magnoliaPublic/travel.html`.

2.  First request: `behaviour=store`

    ```console
    2021-04-07 06:40:09,806 DEBUG info.magnolia.module.cache.filter.CacheFilter :
    Cache policy result: CachePolicyResult{behaviour=store, cacheName=defaultPageCache,
    cacheKey=DefaultCacheKey{uri='/travel.html', serverName='localhost', locale='en', channel='all', params={}', secure='false', method='get', additionalAttributes='{cookiesConsent=dismiss}'},
    cachedEntry=null}
    ```

3.  Second request: `behaviour=useCache`

    ```console
    2021-04-07 06:44:22,511 DEBUG info.magnolia.module.cache.filter.CacheFilter :
    Cache policy result: CachePolicyResult{behaviour=useCache, cacheName=defaultPageCache,
    cacheKey=DefaultCacheKey{uri='/travel.html', serverName='localhost', locale='en', channel='all', params={}', secure='false', method='get', additionalAttributes='{cookiesConsent=dismiss}'},
    cachedEntry=info.magnolia.module.cache.filter.InMemoryCachedEntry@bb8bd81[gzippedContent=5712 bytes,plainContent=25141 bytes,characterEncoding=UTF-8,contentType=text/html,lastModificationTime=1617792009808,originalUrl=http://localhost:8080/dx-core-webapp/travel.html,serializableHeadersBackingList=<null>,statusCode=200,timeToLiveInSeconds=-1]}
    ```


### [](#_cache_policy_result)Cache policy result

With `DEBUG` enabled, the `CachePolicyResult` is printed to the log.

<div class="joplin-table-wrapper"><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 30%;"> <col style="width: 70%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Parameter</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>behaviour</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>One of three values:</p></div><div class="ulist"><ul><li><p><strong>bypass</strong>: Skips caching. This is useful for content that can’t or shouldn’t be cached.</p></li><li><p><strong>useCache</strong>: Retrieves the cached item from the cache and streams it to the client.</p></li><li><p><strong>store</strong>: Stores the response in the cache for future use.</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheName</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>The name of the cache being used to store the result. The <code>defaultPageCache</code> is essentially the fallback cache store for requests that don’t use site-aware caching.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheKey</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>The default cache key implementation is based on the URI, server name, parameters, and request headers.</p></div><div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Since the server name is likely to change from server to server, copying cached items around doesn’t prevent generating cache entries.</td></tr></tbody></table></div><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 33.3333%;"> <col style="width: 66.6667%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Parameter</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>uri</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The URI of the requested resource. This is the key used by the cache for storage and retrieval of the value stored by the cache. The value is the HTML generated during rendering or the binary data of the requested resource.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>serverName</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The requested server.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>locale</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The requested locale.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>channel</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The requested channel. Typical values are all, desktop, and mobile. Sometimes, it can be "unresolved" if the <a href="../../Architecture/Request-processing-and-filters/Filters/#_channel" class="xref page">MultiChannelFilter</a> can’t determine the channel.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>params</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Any parameters passed as part of the request.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>secure</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Indicates if the request was made over a secure connection.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>method</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">The request method. <code>POST</code>, <code>GET</code>, <code>PUT</code>, <code>DELETE</code>, and so on.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>additionalAttributes</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Any other attributes passed as part of the request.</p></td></tr></tbody></table></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>cachedEntry</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>Cache entry keeping the content in memory. Stores a gzipped and non-gzipped version.</p></div><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 33.3333%;"> <col style="width: 66.6667%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Parameter</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>gzippedContent</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Length of the gzipped content.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>plainContent</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Length of the plain content.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>characterEncoding</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Character encoding for the stored content.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>contentType</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Type of content being stored.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>lastModificationTime</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Last time the content was modified.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>originalUrl</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Original requesting URL.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>serializableHeadersBackingList</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">List of serializable headers associated with the request.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>statusCode</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HTTP status code.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeToLiveInSeconds</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Time for how long the content should be valid. <code>-1</code> indicates forever.</p></td></tr></tbody></table></div></td></tr></tbody></table></div>

## [](#_flush_events)Flush events

Cache flush events can happen:

-   When publishing events complete, that is, when content is published successfully from the author to the public instance. This is the default behavior.

-   When content is updated. When debugging a custom cache configuration, it can be helpful to have these flushes indicated in the log file. For example, when using advance caching strategies like [serving old content while recaching](../../../Modules/List-of-modules/Advanced-cache-modules/Advanced-Cache-Policies-module/#_serving_old_content_while_re_caching) or [eager recaching](../../../Modules/List-of-modules/Advanced-cache-modules/Advanced-Cache-Policies-module/#_eager_re_caching).


To enable the `TRACE` level logging for flush events, use the Log Tools app or adjust the log4j2 configuration file.

### [](#_enable_flush_debugging)Enable flush debugging

With flush debugging enabled, you see the flush event indicated in the log. This also provides the name of the cache being flushed if you use multiple caches.

1.  Open the [Log Tools app](../../../Apps/List-of-apps/Log-Tools-app/).

2.  Go to the **Log Levels** tab.

3.  At the bottom of the page, enter the **Logger name**: `info.magnolia.module.cache`.

4.  Click **Add logger config** and check the entry is added to the list above at `ALL` level.


## [](#_site_aware_flush_events)Site-aware flush events

Using the [Advanced Cache module](../../../Modules/List-of-modules/Advanced-cache-modules/) you can configure workspaces to be site-aware. To do so, you must configure:

-   The site-aware flush configuration in the [Advanced Cache app](../../../Modules/List-of-modules/Advanced-cache-modules/Advanced-Cache-app-module/).

-   The mapping configuration of the site definition in the [Multisite definition](../../../Developing/Templating/Site-definition/How-to-use-Multisite/Multisite-definition-configuration/).


### [](#_enable_site_aware_flush_debugging)Enable site-aware flush debugging

#### [](#_when_publishing_completes)When publishing completes

By default, site-aware flush events happen when publishing successfully completes.

The `INFO` log level is enabled by default.

Example

```sh
INFO  info.magnolia.publishing.receiver.operation.jcr.JcrPublicationOperation 30.01.2024 13:09:27 -- About to update content under path [/travel].
INFO  info.magnolia.publishing.transactional.receiver.operation.jcr.JcrTransactionPublicationOperation 30.01.2024 13:09:27 -- 35 User superuser successfully published website:/travel on magnolia-dev-webapp-1.0-SNAPSHOT.
INFO  info.magnolia.module.cache.flushpolicy.FlushAllFromPublishingEventPolicy 30.01.2024 13:09:27 -- Invalidate cache 'defaultPageCache' after 'publish' operation.
INFO  info.magnolia.module.cache.flushpolicy.FlushAllFromPublishingEventPolicy 30.01.2024 13:09:27 -- Invalidate cache 'uuid-key-mapping' after 'publish' operation.
INFO  info.magnolia.module.advancedcache.SiteAwareFlushFromPublishingEventPolicy 30.01.2024 13:09:27 -- Invalidate cache 'travel' after 'publish' operation.
```

#### [](#_when_content_is_updated)When content is updated

You can choose to trigger site-aware flush events when content changes instead. To enable the `TRACE` level logging for flush events, use the Log Tools app or adjust the `log4j2` configuration file.

With flush debugging enabled, you see the flush event indicated in the log. This also provides the name of the cache being flushed if you use multiple caches.

1.  Open the [Log Tools app](../../../Apps/List-of-apps/Log-Tools-app/).

2.  Go to the **Log Levels** tab.

3.  At the bottom of the page, enter the **Logger name**: `info.magnolia.module.advancedcache`.

4.  Click **Add logger config** and check the entry is added to the list above at `ALL` level.

    Example

    ```sh
    INFO  ing.receiver.operation.jcr.JcrPublicationOperation: About to update content under path [/travel].
    INFO  r.operation.jcr.JcrTransactionPublicationOperation: 364 User superuser successfully published website:/travel on magnoliaPublic.
    TRACE ule.advancedcache.SiteAwareFlushAllListeningPolicy: Cache flushed: sportstation
    TRACE ule.advancedcache.SiteAwareFlushAllListeningPolicy: Cache flushed: travel
    TRACE info.magnolia.module.cache.FlushAllListeningPolicy: Cache flushed: uuid-key-mapping
    TRACE ule.advancedcache.SiteAwareFlushAllListeningPolicy: Cache flushed: defaultPageCache

    INFO  ing.receiver.operation.jcr.JcrPublicationOperation: About to update content under path [/travel/tour-type].
    INFO  r.operation.jcr.JcrTransactionPublicationOperation: 360 User superuser successfully published website:/travel/tour-type on magnoliaPublic.
    TRACE ule.advancedcache.SiteAwareFlushAllListeningPolicy: Cache flushed: travel
    TRACE ule.advancedcache.SiteAwareFlushAllListeningPolicy: Cache flushed: defaultPageCache
    TRACE info.magnolia.module.cache.FlushAllListeningPolicy: Cache flushed: uuid-key-mapping
    ```
