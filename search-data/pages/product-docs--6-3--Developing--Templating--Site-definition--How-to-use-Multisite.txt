---
title: "How to use Multisite"
url: https://docs.magnolia-cms.com/product-docs/6.3/Developing/Templating/Site-definition/How-to-use-Multisite/
category: Magnolia 6.3
version: 6.3
breadcrumb: DX Core > Developing > Templating > Site definition > How to use Multisite
---

# How to use Multisite

The core of multisite functionality lies in the use of site definitions. A site definition allows you to control each website separately, for example, configuring different languages or domains per website. Using the [Multisite module](../../../../Modules/List-of-modules/Multisite-module/), you can set up and run multiple websites with different domains and languages from one Magnolia installation.

We present a few typical use cases for a multisite setup and the corresponding configuration required. Full working examples of certain use cases are in the subpages. We assume that you already know some basics about a Magnolia [site definition](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/).

> **Note:** Site limitationIn DX Core, the number of sites that can be used is defined by the number of sites purchased.In the Community Edition, you can only create and use one site.

The page presents a few typical use cases for a multisite setup and the corresponding configuration required. Full working examples of certain use cases are in the subpages. We assume that you already know some basics about a Magnolia [site definition](../).

> **Caution:** Since version 3.0.0 of the Multisite module, site definitions are no longer configured in the config folder of this module, but in the sites subfolder of any module.You can configure a site in a YAML definition (preferred) or directly in the JCR Configuration app.

## [](#_overview)Overview

### [](#_typical_use_cases)Typical use cases

Using multisite makes sense in the following scenarios:

-   You have [multiple websites with completely different purposes](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Multisite-example-Two-sites-with-different-domains/).

-   You have [minisites and run campaigns](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Multisite-example-Minisite-using-URL-prefix-and-domain/).

-   You have different websites for subsidiaries and country branches.

-   You have localized versions of the same website.

-   You use handles and URI prefixes to get shorter URLs.


### [](#_how_multisite_works)How multisite works

You can have one site definition per website. In Magnolia 6.3, site definitions are registered in light modules and not directly in the multisite module, which was the case in Magnolia 6.2. You can control each website independently. Some important aspects of the site definition are explained below.

-   **Site definitions**

    When developing your multisite project, you configure your own [site definition](../).

    For public instances, we strongly recommend that you [map the domains served to their websites](#_mappings_and_domains) unless they are microsites, which mostly won’t have domain mappings. This allows the [mapped content](../#_mapping_a_site_definition_to_your_website) to be served to its respective domain. Optionally, you can add languages. For more on defining locales, see [Define locales for the site](../../../../Administration/Language/Language-configuration/#_define_locales_for_the_site).

    For configuration details, see [Multisite definition configuration](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Multisite-definition-configuration/).

    > **Note:** The Multisite module is delivered with one default site definition called fallback, for details see the Fallback site page.


In the Multisite module, you can optionally configure site resolution rules.

-   **Site resolution rules**

    The site resolution rules ensure that Magnolia can properly assign a site for a given request. The Multisite module comes with a standard set of site resolution rules. The standard rules usually are sufficient. We strongly recommend you be careful if you choose to change these rules.

    When a request is sent to Magnolia, info.magnolia.multisite.filters.MultiSiteFilter analyzes the request to determine which site definition it fits. Once the site has been determined, it is set to info.magnolia.cms.core.AggregationState from where it can be read during further request processing.

    For configuration details, see [Site resolution rules](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Site-resolution-rules/).


### [](#_setting_up_multisite_main_steps)Setting up multisite - main steps

The following bullet points summarize what you need to do to set up a multisite environment with one Magnolia installation:

-   Create a root page of a website and its subpages.

-   Configure site definitions. For each one, define:

    -   A [mapping](../#_mapping_a_site_definition_to_your_website) pointing to the root page of the website.

    -   A [domain mapping](#_mappings_and_domains) to map a domain to the site.


-   Access the distinct content (sub)trees via distinct domains.


> **Note:** When the Multisite module is enabled, you must configure at least one site definition including a proper domain mapping. If you do not do so, pages are not served correctly on the public instance.

| Site | Author Instance | Public Instance |
| --- | --- | --- |
| site a/b | `author.yourdomain.net` | `www.yourdomain.net` ( **a** ) `www.another-domain.net` ( **b** ) |
| Main/German/French | `author.xyzdomain.net` | www.xyzdomain.com ( **Main** ) www.xyzdomain.de ( **DE** ) www.xyzdomain.fr ( **FR** ) |

## [](#_fallback_site)Fallback site

The Multisite module provides a fallback site. The fallback site is a special site definition that is used when no site matches the request. Think of it as a default.

> **Tip:** Creating a fallback.yaml file in a light module’s sites folder overrides the default fallback definition. A fallback definition is created automatically by info.magnolia.multisite.sites.MultiSiteManager#createDefaultFallbackSite if no fallback exists (file-based or in the JCR).

> **Caution:** In Magnolia 6.2, a fallback site could be a folder. In Magnolia 6.3, it has to be a node.

### [](#_choosing_a_fallback_site_definition)Choosing a fallback site definition

When using multisite, it is common to have one main site and some additional sites. It generally makes sense to adapt the fallback site so that it extends your main site. Use the `inherit` property to reference a complete site definition.

For example, the Magnolia Travel Demo has two sites: travel-demo and sportstation. When the demo modules are installed, you can change the fallback definition to extend travel-demo site.

> **Note:** The fallback definition filename must be named fallback.yaml.

-   Full qualified fallback configuration

-   Fallback config inherited from travel-demo


<my-light-module>/sites/fallback.yaml example definition

```yaml
templates:
  class: info.magnolia.module.site.templates.ReferencingPrototypeTemplateSettings
  prototypeId: your-module:pages/default-prototype-of-all-page-templates

theme:
  name: default-theme

i18n:
  class: info.magnolia.cms.i18n.DefaultI18nContentSupport
  enabled: true
  fallbackLocale: en
  locales:
    en:
      country: ''
      enabled: true
      language: en-US (1)
    fr:
      country: ''
      enabled: true
      language: fr (2)
```

|     |     |
| --- | --- |
| **1** | A region-based locale `en-US.` |
| **2** | A language-based locale `fr`. It’s possible to use language-only or region-based locales. |

The overrides in the example site definition below only make sense if you’ve installed the [travel-demo](../../../../Getting-started-with-Magnolia/Demo/).

<my-light-module>/sites/fallback.yaml example definition

```yaml
!inherit:travel (1)
mappings: !override (2)
domains: !override (2)
i18n: !override (2)
  class: info.magnolia.cms.i18n.IetfI18nContentSupport (3)
  enabled: true
  fallbackLocale: fr
  locales: (4)
    fr:
      country: ''
      enabled: true
      languageTag: fr-FR (5)
    cs:
      country: ''
      enabled: true
      languageTag: cs-CZ (5)
```

|     |     |
| --- | --- |
| **1** | This fallback definition includes another site definition, `travel`, which contains the properties mappings, domains, and i18n. |
| **2** | The `mappings`, `domains`, and `i18n` properties are overridden. |
| **3** | The language property’s class follows the IETF BCP 47 standard. |
| **4** | A new `locales` property is defined. |
| **5** | [IETF BCP 47 language tags](../../../../Administration/Language/Language-configuration/#_define_locales_for_the_site). |

| Property | Description |
| --- | --- |
| `<mapping-node>` | **required** Each site can contain multiple mappings. The name of a mapping node is arbitrary (in the example above, the node name is `website` ). The corresponding class for a mapping is info.magnolia.cms.beans.config.URI2RepositoryMapping . |
| `repository` | **required** Name of the JCR workspace the mapping applies to. |
| `handlePrefix` | **required** The path in the workspace the content is served from. |
| `URIPrefix` | **required** Creates a node handle based on a URI. By default, a content request that does not contain a prefix is served from the node defined on `handlePrefix` of the given repository. The `URIPrefix` property can be used to shorten URLs. (See the `jolly-jumper` example above and the [Multisite example - Shorten URL with handlePrefix](Multisite-example-Minisite-using-URL-prefix-and-domain/#_shortening_the_url_with_handleprefix_within_an_existing_site_definition) example.) Short URLs are easier to remember, quicker to type, take less space in print ads, and are ranked more favorably by search engines than content deep down in the site hierarchy. ** If this property is not set, info.magnolia.multisite.MultiSiteURI2RepositoryManager throws an exception (leading to a runtime exception and a server error 500). Add the property with an empty value (or `/` ) if you do not need it. Note that [URIPrefix configuration](../../../../Administration/URI-mapping/) can also be applied in modules independent from site definitions. Configuration in the site definition overrides the configuration in `/server/URI2RepositoryMapping/mappings/<workspace>` , resulting in site-specific definitions. | ** | If this property is not set, info.magnolia.multisite.MultiSiteURI2RepositoryManager throws an exception (leading to a runtime exception and a server error 500). Add the property with an empty value (or `/` ) if you do not need it. |
| ** | If this property is not set, info.magnolia.multisite.MultiSiteURI2RepositoryManager throws an exception (leading to a runtime exception and a server error 500). Add the property with an empty value (or `/` ) if you do not need it. |

## [](#_removing_unwanted_virtualurimapping_on_public_context)Removing unwanted virtualURIMapping on public context

Make sure you have no unwanted virtualURIMapping redirections on the public context.

Use the [Configuration app](../../../../Apps/List-of-apps/Configuration-app/) on the public context and search for `virtualURIMapping`. On a standard Magnolia bundle you most probably find the node `/modules/ui-admincentral/virtualURIMapping/default` which redirects to */.magnolia/admincentral*. You must delete the node to ensure a request to http://<your-domain>/ really serves the root page of your site. (For further details look at the [example](Multisite-example-Two-sites-with-different-domains/#_remove_unwanted_virtualURIMapping_on_public_context)).

## [](#_site_resolution_rules)Site resolution rules

The site resolution rules ensure that Magnolia can properly assign a site for a given request. The Multisite module comes with a standard set of site resolution rules. The standard rules usually are sufficient.

> **Warning:** If you change the site resolution rules, verify your changes on a test system before making any changes to your production environment. Errors in the site resolution rules can break your site.

## [](#_configuration_examples)Configuration examples

To understand multisite setup in different use cases, look at the following examples:

-   [Minisite using URL prefix and domain](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Multisite-example-Minisite-using-URL-prefix-and-domain/)

-   [Two sites with different domains](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Multisite-example-Two-sites-with-different-domains/)


Related topics

-   [Multisite module](../../../../../RNs-6-4-3/Modules/List-of-modules/Multisite-module/)

    -   [Site resolution rules](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Site-resolution-rules/)


-   [Magnolia setup and domains in a production environment](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/Magnolia-setup-and-domains-in-a-production-environment/)

-   [Site definition](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/)

-   [Apache httpd in front of Tomcat](https://wiki.magnolia-cms.com/display/WIKI/Apache+httpd+in+front+of+Tomcat+on+a+local+dev+machine)
