---
title: "Configuration management"
url: https://docs.magnolia-cms.com/product-docs/6.3/Administration/Architecture/Configuration-management/
category: Magnolia 6.3
version: 6.3
breadcrumb: DX Core > Administration > Architecture > Configuration management
---

# Configuration management

## [](#_properties)Properties

Property files are used for configuration during the startup sequence before the repository is available. These properties configure the instance for a particular use (such as a development or production environment) and set various system directories. Once the startup sequence is completed and the repository is available, the majority of configuration is done in the `config` [workspace](../Workspaces/) in the repository.

Properties aren’t stored in a single property file but come from multiple sources. These sources are processed or parsed in this order:

|     | Source | Location | Path |
| --- | --- | --- | --- |
| 1   | Bean properties | classpath | `/mgnl-beans.properties` |
| 2   | Module properties | [Module descriptor](../../../Modules/Module-descriptor/) | ```xml<br><properties><br>  <property><br>    <name>defaultPublicURI</name><br>    <value>redirect:/help.html</value><br>  </property><br></properties><br>``` |
| 3   | Global file properties | web application | `WEB-INF/config/magnolia.properties` |
| 4   | Default file properties | web application | `WEB-INF/config/default/magnolia.properties` |
| 5   | Web application file properties | web application | `WEB-INF/config/(webapp)/magnolia.properties` |
| 6   | Server file properties | web application | `WEB-INF/config/(servername)/magnolia.properties` |
| 7   | Web application at server file properties | web application | `WEB-INF/config/(servername)/(webapp)/magnolia.properties` |
| 8   | [Environment variables](https://smallrye.io/smallrye-config/Main/config/getting-started/#environment-variables) | host operating system |     |
| 9   | [System properties](https://smallrye.io/smallrye-config/Main/config/getting-started/#system-properties) | JVM options<br><br>(`-Dx=y`) |     |

Sources processed earlier may be overridden by sources processed later. The processing order and distribution of properties into several sources allows for flexible customization.

Some important properties set in the default `magnolia.properties` file:

```java
# Repository configuration
magnolia.repositories.config = WEB-INF/config/default/repositories.xml
magnolia.repositories.home = ${magnolia.app.rootdir}/repositories
magnolia.repositories.jackrabbit.config = WEB-INF/config/repo-conf/jackrabbit-bundle-h2-search.xml

# Defining the instance as author instance
# Only used for the initial installation.
# Afterwards configuration in the config repository is used.
# The value is saved in /server/admin
magnolia.bootstrap.authorInstance=true

# Switch to false to enhance the performance of Javascript generation
magnolia.develop=false

# Set to true if bootstrapping/update should be performed automatically
magnolia.update.auto=false
```

> **Note:** magnolia.app.rootdir is set programmatically during Magnolia start-up. Its value depends on the servlet container and on the environment, for instance on a production Tomcat it would be something like /some-path/some-tomcat/webapps.

### [](#_profile_based_configuration_of_property_files)Profile-based configuration of property files

To resolve property files in Magnolia 6.2.2+, you can use `MAGNOLIA_PROFILE` to configure a profile as an environment variable or system property. A profile is a folder under `/WEB-INF/config/` containing Magnolia property files. See info.magnolia.init.DefaultMagnoliaPropertiesResolver for more information.

**Example configuration**

In addition to being part of the `default` profile, `magnolia-empty-webapp` is distributed with the `develop` profile (see [Bundles and webapps](../../../Developing/Bundles-and-webapps/)). To use this profile, set `MAGNOLIA_PROFILE` to `develop` so that the property files in the `develop` folder are read. This sets the following properties to the specified values:

```java
  magnolia.resources.dir=${magnolia.home}/../../src/main/magnolia
  magnolia.repositories.home=${magnolia.home}/../../repositories
  magnolia.develop=true
  magnolia.ui.sticker.environment=${MAGNOLIA_PROFILE}
  magnolia.ui.sticker.color=red
```

If no profile value is specified, Magnolia falls back to configuration based on the server name, webapp name, and context path. If you set the value to a profile that doesn’t exist, an error message is logged and Magnolia fails to start. Note that no such check is performed when the `magnolia.initialization.file` context attribute is set to a custom value.

### [](#_multiple_configurations_in_a_single_web_application_archive)Multiple configurations in a single web application archive

Default properties are common regardless of the server name or webapp name. Webapp specific properties are installed only if the webapp name matches. Correspondingly, server specific properties are only installed if the server name matches. For example, Magnolia ships with two webapps by default: `magnoliaAuthor` and `magnoliaPublic`.

It is possible to set a different persistence manager per environment. For example, on the development instance you could use the default embedded Derby database, whilst on production you could use a production-scale persistent storage such as a MySQL database.

See [WAR file with multiple configurations](../../Deploying/WAR-file-with-multiple-configurations/) for more on this topic.

The [MySQL InnoDB storage engine](http://dev.mysql.com/doc/refman/5.5/en/storage-engine-setting.html) is supported by Magnolia, the MyISAM engine is not. InnoDB is the default engine in MySQL 5.5 and higher.

### [](#_customization)Customization

The structure and the order of source execution allows you to provide sophisticated configurations and flexible customization. The default Magnolia configuration (delivered in the web application bundle) provides an example of how the mechanism works:

-   `WEB-INF/config/default/magnolia.properties`

-   `WEB-INF/config/magnoliaAuthor/magnolia.properties`

-   `WEB-INF/config/magnoliaPublic/magnolia.properties`


Magnolia provides a single web application which configures itself depending on the servlet context it’s installed in. If your environment has multiple staging systems with differing configuration needs, you can apply different configurations by adding a server name to each of the listed paths.

For complex environments, the order of loading files can be defined in `WEB-INF/web.xml` as a `context-param` element:

```xml
<context-param>
   <param-name>magnolia.initialization.file</param-name>
      <param-value>
         WEB-INF/config/${servername}/${webapp}/magnolia.properties,
         WEB-INF/config/${servername}/magnolia.properties,
         WEB-INF/config/${webapp}/magnolia.properties,
         WEB-INF/config/default/magnolia.properties,
         WEB-INF/config/magnolia.properties
      </param-value>
</context-param>
```

> **Note:** The properties files you specify in`WEB-INF/web.xml` are evaluated in reverse order, from bottom to top. That means the first properties file in the list (in the example above, WEB-INF/config/${servername}/${webapp}/magnolia.properties) can override values defined in all the other files lower down in the list.

#### [](#_modifying_the_magnolia_home_property)Modifying the magnolia.home property

The default configuration of the `magnolia.home` property is intended to facilitate development.

For production deployments, you should change the value of the property to a different location, for example to `/opt/magnolia1` on your filesystem.

> **Caution:** Changing just the value of the magnolia.home property doesn’t make your bundle production-ready instantly.It is also recommended to change the persistence settings and few other things, such as configuration of repositories, workspaces, and ACLs.

### [](#_defining_properties)Defining properties

> **Note:** The properties can be accessed through the info.magnolia.init.MagnoliaConfigurationProperties class.All of these properties can also be set at the JVM level using the -D flag, for example:-Dmagnolia.repositories.jackrabbit.indexing.optimization=true⚠️ Setting them via the -D overrides the setting defined in the magnolia.properties configuration file.

<div class="joplin-table-wrapper"><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 50%;"> <col style="width: 50%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Property</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>log4j.config</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong></p></div><div class="paragraph"><p><em>default is <code>WEB-INF/config/default/log4j.xml</code></em></p></div><div class="paragraph"><p>Name of a log4j config file. Can be a .properties or .xml file. The value can be:</p></div><div class="ulist"><ul><li><p>a full path</p></li><li><p>a path relative to the webapp root</p></li><li><p>a file name, that’s loaded from the classpath</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.author.key.location</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/WEB-INF/config/default/magnolia-activation-keypair.properties</code></em></p></div><div class="paragraph"><p>Location of private and public activation keys used for <a href="../../Security/Publishing-security/" class="xref page">publishing</a>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.bootstrap.authorInstance</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>true</code></em></p></div><div class="paragraph"><p>Sets an instance as author (<code>true</code>) or public (<code>false</code>).</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.bootstrap.dir</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong></p></div><div class="paragraph"><p><em>default is <code>WEB-INF/bootstrap/author WEB-INF/bootstrap/common</code></em></p></div><div class="paragraph"><p>Directory containing XML or YAML files for initialization of a blank Magnolia instance. If no content is found in any of the repositories, they’re initialized by importing the XML or YAML files found in this folder. If you don’t want to let Magnolia initialize repositories automatically then remove this parameter.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.bootstrap.samples</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>true</code></em></p></div><div class="paragraph"><p>Some modules contain optional sample content. They check this property to decide if they should install the content.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.cache.startdir</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>Directory used for cached pages.</p></div><div class="paragraph"><p>In the <a href="../../Deploying/WAR-file-with-multiple-configurations/#_magnolia_properties_file" class="xref page"><code>magnolia.properties</code> file</a>, the <code>magnolia.cache.startdir</code> property is preset to <code>${magnolia.home}/cache</code>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.cipher.algorithm</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>RSA/NONE/OAEPWithSHA3-256AndMGF1Padding</code> since Magnolia 6.2.37</em></p></div><div class="paragraph"><p>The algorithm used for data encryption, such as for passwords stored by the <a href="../../../Modules/List-of-modules/Password-Manager-module/" class="xref page">Password Manager module</a>. This isn’t used for signing publication requests.</p></div><div class="paragraph"><p>Supported algorithms: <a href="https://www.bouncycastle.org/specifications.html" class="bare" target="_blank" rel="noopener">https://www.bouncycastle.org/specifications.html</a></p></div><div class="paragraph"><p>You must set the same cipher on all instances if they share encrypted data.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content">If you change the cipher, any data previously encrypted with the old cipher (such as stored passwords in the Password Manager module, the <a href="../../../Modules/List-of-modules/LDAP-Connector-module/" class="xref page">LDAP Connector module</a>, and potentially other places if you used it for data storage purposes in your custom code) is unreadable. You must re-create this data after changing the algorithm.</td></tr></tbody></table></div><div class="paragraph"><p>For versions before 6.2.37, the default was <code>RSA/None/PKCS1Padding</code>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.signature.algorithm</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong>, <em>default is <code>SHA256withRSA</code></em></p></div><div class="paragraph"><p>Sets the signature algorithm. This algorithm is used to sign authorization headers for publication requests between author and public instances.</p></div><div class="paragraph"><p>Its value can be for RSA cryptosystem <code>SHA256withRSA</code> or for EC cryptography <code>SHA256withECDSA</code>.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="fa icon-caution" title="Caution"></i></td><td class="content">The <code>magnolia.signature.algorithm</code> property introduces a new header <code>X-magnolia-act-auth-signature</code> which you should bear in mind when connecting to AWS gateways.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.publishing.authentication.signature.enabled</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong>, <em>default is <code>true</code></em></p></div><div class="paragraph"><p>If this property is set to <code>false</code>, the signature algorithm isn’t used for authentication, and only publishing requests from localhost are allowed. You must add it on both author and public instances with the same value when set.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="fa icon-caution" title="Caution"></i></td><td class="content">In some deployments where you disable this property due to a safe publishing endpoint, you must also disable the following voter: <code>/server/filters/multipartRequest/bypasses/notAuthenticatedOrInDevelopMode/voters/isNotSignedPublicationRequest/voters/isSigned</code>. This voter checks whether incoming publication requests have a valid signature. When you disable signature authentication, the author instance no longer signs publication requests, so the <code>isSigned</code> voter rejects them. Disabling this voter allows unsigned publication traffic through the filter.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.keygen.algorithm</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong>, <em>default is <code>RSA</code></em></p></div><div class="paragraph"><p>Specifies the properties used by the system for key pair generation. You can set it to <code>RSA</code> or <code>EC</code>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.keygen.key.length</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong>, <em>default is <code>4096</code></em></p></div><div class="paragraph"><p>For the RSA signature mechanism, specifies the key length. You should only change this property if the RSA algorithm is used for publication.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.keygen.ec.curve.name</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong>, <em>default is <code>prime256v1</code></em></p></div><div class="paragraph"><p>For the EC signature mechanism, specifies the curve name. You should only change this property if the EC algorithm is used for publication.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.clusterid</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is set in set in Jackrabbit configuration file</em></p></div><div class="paragraph"><p>The ID of the JCR cluster instance.</p></div><div class="paragraph"><p>When setting the value in <em>magnolia.properties</em>, it overrides the value set in the Jackrabbit configuration file; this allows using a single configuration file for all the cluster instances.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.components.config.properties.excluded</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>List of component class names to be excluded from component instantiation. Separate class names with white space (space, tab) or commas.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.config.locations</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>This path defines locations to scan for the <code>microprofile-config.properties</code> and <code>microprofile-config.yaml</code> files.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.content.bootstrap.createTasks</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>always</code></em></p></div><div class="paragraph"><p>Co-specifies a content <a href="../../../Modules/List-of-modules/Content-Importer-module/#_bootstrapping_settings" class="xref page">bootstrapping strategy</a>. The following values can be used:</p></div><div class="ulist"><ul><li><p><code>always</code>: A workflow task is always created to import a content item. No content is bootstrapped automatically.</p></li><li><p><code>onchange</code>: Content is bootstrapped automatically if the path doesn’t exist in JCR. If the path exists, a task is created.</p></li><li><p><code>never</code>: No workflow task to import content is created. Content is bootstrapped at every startup and after every change.</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.content.bootstrap.dir</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>The directory to import file system files from with the <a href="../../../Modules/List-of-modules/Content-Importer-module/" class="xref page">Content Importer module</a>.</p></div><div class="paragraph"><p>If the path isn’t set, the module is stopped.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.content.bootstrap.onlyImportAtInstall</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Co-specifies a content <a href="../../../Modules/List-of-modules/Content-Importer-module/#_bootstrapping_settings" class="xref page">bootstrapping strategy</a>.</p></div><div class="admonitionblock important"><table><tbody><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content">If set to <code>true</code>, content is bootstrapped only at installation, not at every instance startup.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.content.bootstrap.pattern</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>*.{yaml,xml}</code></em></p></div><div class="paragraph"><p>Specifies which filenames are imported and observed in the content bootstrap directory defined by the <code>magnolia.content.bootstrap.dir</code> property.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.definitions.classpath</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong> <em>if you deploy on a WebSphere, Liberty or JBoss application server</em></p></div><div class="paragraph"><p>Value must be set to <code>info.magnolia</code>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.delivery.escaping</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>Content delivered through REST delivery endpoints is automatically HTML-escaped to enhance security.</p></div><div class="paragraph"><p>To revert to the previous behavior (no HTML escaping), set the <code>magnolia.delivery.escaping</code> property to <code>compatibility</code>.</p></div><div class="paragraph"><p>When this is set, you must manually handle escaping in your application as needed.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.develop</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p><code>magnolia.develop</code> is a configuration property that can be set to <code>true</code> in the <code>magnolia.properties</code> file for development purposes, specifically to:</p></div><div class="ulist"><ul><li><p>Enable <span id="inlineBean">info.magnolia.classpathwatch.ClasspathScanner</span>, when developing via IDE and changing/deploying edited classpath-based resources.</p></li><li><p>Disable the cache for resources.</p></li></ul></div><div class="paragraph"><p>Set to <code>false</code> on production instances.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.event.scheduler.pool.size</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is</em> the number of available processors</p></div><div class="paragraph"><p>The number defines the core pool size of the event scheduler, which dispatches events to JCR observations. For performance concerns, the default and upper limit value of this configuration is set to the number of available processors.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.exchange.history</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/history</code></em></p></div><div class="paragraph"><p>History directory used for publishing.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.graphql.introspection.enabled</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Since Magnolia 6.3.6, <a href="../../../Developing/API/GraphQL-API/#_introspection" class="xref page">GraphQL introspection</a> is disabled by default as a security best practice.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="fa icon-caution" title="Caution"></i></td><td class="content">For development purposes, you may enable it by setting this property to <code>true</code>. Always make sure that enabling introspection is intentional as it exposes schema details.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.home</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.app.rootdir}</code></em></p></div><div class="paragraph"><p>Root of the webapp’s deployment directory.</p></div><div class="paragraph"><p>See also <a href="#modifying_the_magnolia.home_property">Modifying the magnolia.home property</a> above on this page.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.image.recognition.numberOfThreads</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is</em> <code>1</code></p></div><div class="paragraph"><p>The number of parallel recognition threads for <a href="#image-recognition:ROOT:index.adoc" class="xref unresolved">image recognition</a>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.jcr.query.logging.thresholdMs</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>no threshold / logging disabled</code></em></p></div><div class="paragraph"><p>Magnolia logs each JCR query exceeding the threshold in milliseconds.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.jsr250.enabled</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Enables support for JSR-250 annotations. Magnolia uses the <code>@PostConstruct</code> annotation in methods that need to be executed after dependency injection is done to perform any initialization. Enabling JSR-250 support impacts performance.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a id="magnolia-license-key"></a><code>magnolia.license.key</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>License key for DX Core. You are not limited to a single line; for example, you may prefer a multi-line format in YAML. For system properties or environment variables, a single-line value is usually more practical.</p></div><div class="paragraph"><p>You can use any configuration mechanism supported by Magnolia to set this property. That includes environment variables, system properties, and also <code>magnolia.properties</code> (or YAML) files.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="fa icon-caution" title="Caution"></i></td><td class="content">Providing secrets via JVM arguemnts or environment variables can expose them through process inspection, command-line arguments, or the About app’s configuration properties. You should use <code>magnolia.license.location</code> for more security if required in your environment.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a id="magnolia-license-location"></a><code>magnolia.license.location</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>Absolute path to a file containing the license key.</p></div><div class="paragraph"><p>This property is suitable for container secret mounts such as Docker or Kubernetes. Docker Compose exposes secrets under <code>various/run/secrets/{name}</code> by default, while Kubernetes does it under <code>/run/secrets/{name}</code>.</p></div><div class="paragraph"><p><br></p></div><div class="paragraph"><p><span class="icon"><i class="fa fa-sort"></i></span>The resolution order for license configurations is as follows.</p></div><div class="olist arabic"><ol class="arabic"><li><p>Get the license from <code>magnolia.license.key</code>.</p></li><li><p>If not set, get it from <code>magnolia.license.location</code>.</p></li><li><p>If not set, get it from <code>${magnolia.home}/license.key</code>.</p></li><li><p>If still not found, nothing happens and the license currently configured in the system (if any) is left unchanged.</p></li></ol></div><div class="paragraph"><p><br></p></div><div class="paragraph"><p><span class="icon"><i class="fa fa-refresh"></i></span>This property’s location and the <a href="#magnolia-license-key">default license key</a> location <a href="#magnolia-license-watch-enabled">are monitored for file changes</a> to provide a convenient way to update the license without manual intervention through the UI or restarting the application to reload it from a configuration (system properties, environment variables, etc.).</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><a id="magnolia-license-watch-enabled"></a><code>magnolia.license.watch.enabled</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>true</code></em></p></div><div class="paragraph"><p>Enables monitoring the license file and automatic reloading of the license on file changes.</p></div><div class="paragraph"><p>Default behavior: monitoring is enabled when either <code>magnolia.license.location</code> is specified or a license is found at <code>${magnolia.home}/license.key</code>. Set to <code>false</code> to disable monitoring in all cases.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.logs.dir</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/logs</code></em></p></div><div class="paragraph"><p>Directory where logs are written.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.migration.persistReport</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Turns off migration report generation to speed up the migration process. Set to <code>true</code> to generate reports.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.password.manager.key.location</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/WEB-INF/config/default/magnolia-password-manager-keypair.properties</code></em></p></div><div class="paragraph"><p>Location of the file containing both the private and the public keys used to encrypt and decrypt passwords stored by the Password manager.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content">DX Cloud customers should not set this property. It is set automatically for you. Overriding this property may cause issues with your deployment.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.repositories.config</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong></p></div><div class="paragraph"><p><em>default is <code>WEB-INF/config/default/repositories.xml</code></em></p></div><div class="paragraph"><p>Repository configuration, points to an XML file.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.repositories.home</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/repositories</code></em></p></div><div class="paragraph"><p>Repository home directory.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.repositories.jackrabbit.cluster.config</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>Jackrabbit configuration file for a <a href="../../Instances/Clustering/" class="xref page">clustered repository</a>.</p></div><div class="admonitionblock warning"><table><tbody><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content">Always define the <code>cluster.config</code> and <code>cluster.master</code> properties together if any of your workspaces are clustered.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.repositories.jackrabbit.cluster.master</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong> <em>if you have any clustered workspaces in your project</em></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Identifies the instance as a cluster master node. During installation and update Magnolia bootstraps content only into master nodes. This ensures that other (replica) nodes installed later don’t override already bootstrapped content.</p></div><div class="paragraph"><p>Example: Public instance A is defined as a cluster master node. The instance starts and creates a clustered <code>forum</code> workspace and bootstraps some content such as rules of conduct. Second public instance B is defined as a replica node. It starts moments later but doesn’t bootstrap the same workspace again.</p></div><div class="ulist"><ul><li><p><code>true</code> defines the instance is a cluster master node. Content is bootstrapped into the repository.</p></li><li><p><code>false</code> defines the instance as a cluster replica node. Content isn’t bootstrapped into the repository.</p></li></ul></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.repositories.jackrabbit.config</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>WEB-INF/config/repo-conf/jackrabbit-bundle-derby-search.xml</code></em></p></div><div class="paragraph"><p><a href="http://jackrabbit.apache.org/jcr/jackrabbit-configuration.html">Jackrabbit configuration</a> file. See the <code>repo-conf</code> directory for configuration files for other <a href="../Content-storage-and-structure/" class="xref page">persistence managers</a> such as MySQL, PostgreSQL and Ingres.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.repositories.jackrabbit.indexing.optimization</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>If set to <code>true</code>, you may leverage the <a href="../../Jackrabbit-search/#_skipping_properties" class="xref page">special indexing optimization rules</a> on the respective Magnolia instance.</p></div><div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">This is an experimental feature introduced with Magnolia 6.3.8. It’s not set by default in the properties file.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.resources.classpath.observation.pattern</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>.*\\.(ftl|yaml)$</code></em></p></div><div class="paragraph"><p>Pattern to define which resources should be observed by <code>ClasspathScanner</code>.</p></div><div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">The default pattern above observes any file names that end in <code>.ftl</code> and <code>.yaml</code>.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.resources.dir</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/modules</code></em></p></div><div class="paragraph"><p>Defines the directory from which filesystem <a href="../../../Developing/Resources/" class="xref page">resources</a> such as <a href="../../../Modules/#_light_module" class="xref page">light modules</a> are loaded in a Magnolia instance.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.resources.filesystem.observation.excludedDirectories</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>META-INF,WEB-INF,cache,docroot,logs,repositories,tmp</code></em></p></div><div class="paragraph"><p>List of excluded resource directories in FileSystemResourceOrigin.</p></div><div class="admonitionblock note"><table><tbody><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">For example, if you are using the node_modules directory when developing locally, you can use <code>magnolia.resources.filesystem.observation.excludedDirectories=node_modules</code> to prevent slow loading of pages.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.resources.watcher.sensitivity</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>high</code></em></p></div><div class="paragraph"><p>The sensitivity (speed) with which the changes of the <a href="../../../Developing/Resources/" class="xref page">resources</a> in the <code>magnolia.resources.dir</code> are observed by the <span id="inlineBean">info.magnolia.dirwatch.DirectoryWatcherService</span>.</p></div><div class="paragraph"><p>Possible values: <code>low</code>, <code>medium</code>, <code>high</code>. For development purposes on OSX it’s recommended to set the property to <code>high</code>.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.templating.escaping</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>Content is available in template scripts via templating functions and, for the most part, automatically encoded.</p></div><div class="paragraph"><p>Before the Magnolia 6.3.5 release, we identified some templating directives that weren’t compliant with this security encoding. To fix this, escaping content to enable encoding is set by default for all directives since the 6.3.5 release.</p></div><div class="paragraph"><p>If you’re affected, you can disable the encoding fixes by setting the <code>magnolia.templating.escaping</code> property to <code>compatibility</code>. Afterwards, you must manually decode them in the FreeMarker template through the <code>TemplatingFunctions#decode</code> method.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.ui.sticker.color</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>The properties add a sticker to the AdminCentral interface to provide a clear visual clue about the type of the <a href="../../../Getting-started-with-Magnolia/Glossary/#_cloud_environment" class="xref page">environment</a> and instance the user is currently interacting with.</p></div><div class="dlist"><dl><dt class="hdlist1">Example configuration</dt><dd><p><code>magnolia.ui.sticker.environment=LIVE</code></p></dd></dl></div><div class="paragraph"><p><code>magnolia.ui.sticker.color=green</code></p></div><div class="paragraph"><p>On the author instance, the following sticker appears:</p></div><div class="paragraph"><p><span class="image zoom"><img src="../../../_images/6-1-envSticker.png" alt="Live sticker"></span></p></div><div class="paragraph"><p>The instance name is taken from the <code>${magnolia.webapp}</code> property, which corresponds to the name of the folder into which Magnolia is deployed.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">For color values, use a CSS3 unit, see <a href="https://www.w3.org/TR/css-color-3/#colorunits" class="bare" target="_blank" rel="noopener">https://www.w3.org/TR/css-color-3/#colorunits</a>. If no color is set, the color of the sticker defaults to <code>rgb(35, 35, 35)</code>.</td></tr></tbody></table></div><div class="paragraph"><p>The instance info sticker was originally released with Magnolia 5.6.3 as the <code>info.magnolia.ui.admincentral.sticker.StickerViewImpl</code> class. With the release of Magnolia 6.1, the class changed to <code>info.magnolia.admincentral.components.InstanceInfo</code>. If you have a custom sticker implementation on Magnolia 6.2 or higher, make sure it’s based on the <code>InstanceInfo</code>, otherwise your implementation isn’t rendered in the UI.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.ui.sticker.environment</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p>The properties add a sticker to the AdminCentral interface to provide a clear visual clue about the type of the <a href="../../../Getting-started-with-Magnolia/Glossary/#_cloud_environment" class="xref page">environment</a> and instance the user is currently interacting with.</p></div><div class="dlist"><dl><dt class="hdlist1">Example configuration</dt><dd><p><code>magnolia.ui.sticker.environment=LIVE</code></p></dd></dl></div><div class="paragraph"><p><code>magnolia.ui.sticker.color=green</code></p></div><div class="paragraph"><p>On the author instance, the following sticker appears:</p></div><div class="paragraph"><p><span class="image zoom"><img src="../../../_images/6-1-envSticker.png" alt="Live sticker"></span></p></div><div class="paragraph"><p>The instance name is taken from the <code>${magnolia.webapp}</code> property, which corresponds to the name of the folder into which Magnolia is deployed.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">For color values, use a CSS3 unit, see <a href="https://www.w3.org/TR/css-color-3/#colorunits" class="bare" target="_blank" rel="noopener">https://www.w3.org/TR/css-color-3/#colorunits</a>. If no color is set, the color of the sticker defaults to <code>rgb(35, 35, 35)</code>.</td></tr></tbody></table></div><div class="paragraph"><p>The instance info sticker was originally released with Magnolia 5.6.3 as the <code>info.magnolia.ui.admincentral.sticker.StickerViewImpl</code> class. With the release of Magnolia 6.1, the class changed to <code>info.magnolia.admincentral.components.InstanceInfo</code>. If you have a custom sticker implementation on Magnolia 6.2 or higher, make sure it’s based on the <code>InstanceInfo</code>, otherwise your implementation isn’t rendered in the UI.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.update.auto</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Set to <code>true</code> if bootstrapping and update should be performed automatically after installation. This means the system won’t wait for the user to start the update manually.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.upload.tmpdir</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>required</strong></p></div><div class="paragraph"><p><em>default is <code>${magnolia.home}/tmp</code></em></p></div><div class="paragraph"><p>Temporary directory for uploaded files.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.utf8.enabled</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is <code>false</code></em></p></div><div class="paragraph"><p>Activate <a href="../../Language/Language-configuration/" class="xref page">UTF-8 support for pages</a>.</p></div><div class="admonitionblock caution"><table><tbody><tr><td class="icon"><i class="fa icon-caution" title="Caution"></i></td><td class="content">The value must be the same on both the author and public instance. Publication between instances with a different UTF-8 setting is not supported.</td></tr></tbody></table></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>magnolia.yaml.maxAliasesForCollections</code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><strong>optional</strong></p></div><div class="paragraph"><p><em>default is</em> <code>50</code></p></div><div class="paragraph"><p>The number of aliases for <a href="https://www.javadoc.io/doc/org.yaml/snakeyaml/1.26/org/yaml/snakeyaml/LoaderOptions.html#setMaxAliasesForCollections-int-" target="_blank" rel="noopener"><code>getMaxAliasesForCollections</code></a> to prevent a <a href="https://en.wikipedia.org/wiki/Billion_laughs_attack" target="_blank" rel="noopener">Billion Laughs Attack</a>.</p></div></div></td></tr></tbody></table></div>

> **Note:** In addition to these examples you can define arbitrary properties (magnolia.home is one example).

**Substitution**

Properties can be used to prefixother path-like properties. For example, in `magnolia.cache.startdir=${magnolia.home}/cache` the property `magnolia.cache.startdir` is set by substituting the root directory with property `magnolia.home`. See [WAR file with multiple configurations](../../Deploying/WAR-file-with-multiple-configurations/) on how to use properties to target a deployment environment.

## [](#_interpolate_environment_variables_in_light_modules)Interpolate environment variables in light modules

Use these subsections to learn how to enable YAML variable interpolation in light modules and how to view the resulting interpolated values in the UI.

### [](#_enable_and_use_interpolation)Enable and use interpolation

You can have different configurations in one or more environments. To enable interpolation, you must first set the `magnolia.yaml.envsubst` feature flag (JVM option) to `true`. You can then use the following syntax in a YAML file, which parses the environment variable:

```yaml
label: !env ${ENV} (1)
<url>: !env https://${ENV}.api.com/<endpoint>
```

|     |     |
| --- | --- |
| **1** | Make sure you have a space after the `!env` annotation as shown above. |

This feature only works via environment variables, not Java options or Magnolia properties. Environment variables are created from your terminal or IDE. You’ll need to export the variable(s) like so:

```sh
export API_BASE_URL=https://example.com/
```

> **Note:** Interpolating environment variables only applies to plain YAML definitions and YAML decorator files, not to YAML bootstrap files.

### [](#_view_interpolated_values_and_sensitive_data)View interpolated values and sensitive data

By default, all configuration values in the [About](../../../Apps/List-of-apps/About-Magnolia-app/) app are blurred to hide sensitive data, such as API tokens; click them to unblur them. Sensitive data from environment variables is visible in [Definition](../../../Apps/List-of-apps/Definitions-app/#_interpolated_variables) apps only to users with a superuser role.

To view an environment variable’s value:

1.  Open the [About](../../../Apps/List-of-apps/About-Magnolia-app/) app and go to the Config Info tab.

2.  Click a row to reveal and copy the variable’s value (values are blurred by default).


If you don’t know the environment variable’s name:

1.  In the Resources app, locate the YAML source file that contains the property using the `!env` placeholder.

2.  The variable’s value is hidden, but once identified, note the variable name of the placeholder in the file.

3.  Return to the About app to retrieve and copy its value as described above.


## [](#_component_and_type_mappings_overriding)Component and type mappings, overriding

> **Note:** You can override Magnolia defaults within your module descriptors, except for observed components, which are managed via JCR.Ensure to include a module descriptor dependency for the module you are overriding.

### [](#_type_mapping)Type mapping

Type mappings allow specifying or overriding the implementation used when creating instances of a type via `componentProvider#newInstance`.

For example, the following configuration defines an implementation:

```xml
<type-mapping>
  <type>info.magnolia.rendering.template.TemplateDefinition</type>
  <implementation>info.magnolia.rendering.template.configured.ConfiguredTemplateDefinition</implementation>
</type-mapping>
```

You can then override an implementation used when calling:

```java
componentProvider#newInstance(TemplateDefinition.class)
```

For more details, see `<type-mapping>` for example in the [`magnolia-ce / ui`](https://gitlab.com/search?group_id=99294163&nav_source=navbar&project_id=66245872&repository_ref=release%2F6.3&scope=blobs&search=%3Ctype-mapping%3E+extension%3Axml&search_code=true) Gitlab repository.

### [](#_component_mapping)Component mapping

Component mappings define or override the implementation used when injecting a component, such as through constructor injection.

For example, suppose you have the following configuration:

```xml
<component>
  <type>info.magnolia.ui.contentapp.observation.JcrObservation</type>
  <implementation>info.magnolia.ui.contentapp.observation.JcrObservation</implementation>
</component>
```

You can then override an implementation used when injecting `JcrObservation`:

```java
@Inject
SomeConstructor(JcrObservation jcrObservation) {
   this.jcrObservation = jcrObservation;
}
```

For more details, see `<component>` for example in the [`magnolia-ce / ui`](https://gitlab.com/search?group_id=99294163&nav_source=navbar&project_id=66245872&repository_ref=release%2F6.3&scope=blobs&search=%3Ccomponent%3E+extension%3Axml&search_code=true) Gitlab repository.

### [](#_observed_components)Observed components

Observed components are configured to delegate their configuration fully to JCR, typically manageable at runtime via the JCR Configuration app.

Their implementation cannot be overridden by other modules.

They often include setters to allow runtime configuration.

An example configuration is:

```xml
<component>
  <type>info.magnolia.audit.AuditLoggingManager</type>
  <workspace>config</workspace>
  <path>/server/auditLogging</path>
  <observed>true</observed>
  <scope>singleton</scope>
</component>
```

For more details, see the Magnolia CMS online demo, in the Configuration app: [`auditLogging@class`](https://demo.magnolia-cms.com/.magnolia/admincentral#app:configuration:browser;/server/auditLogging@class:treeview).

## [](#_extending_configuration)Extending configuration

You can extend a configuration by defining an `extends` property and setting its value to the source configuration you want it to inherit. The target configuration inherits everything from the source and adds its own exceptions. This can save time and effort as you only need to define exceptions explicitly. The mechanism is only available in the `config` repository.

In the example below, the `sportstation` site definition extends the `travel` site definition. The definition inherits all configuration from the `travel` configuration and adds its own domains, internationalization and URI-to-repository mappings, theme and templates. The `extends` property can point to the source configuration with an absolute or relative path.

![Definition example](../../../_images/ADVT-configmgt-ext.png)

### [](#_overriding)Overriding

Extending is additive by default, which means that configuration specified at the extending level is added to the inherited configuration. Setting the `extends` property to `override` changes this behavior. An override allows the extending node to completely remove the inherited content and replace it with its own content entries. In the example below, the `travel` site definition supports two locales, `en` (English) and `de` (German), whereas site `travel-fr` is targeted to French speakers only.

The French site extends `travel`. It inherits all configuration except the locales. An override under the locales node removes `en` and `de`. Only the French locale `fr` defined at this level is applied. This means that authors can enter only French content on the French site.

![Locales node](../../../_images/ADVT-configmgt-override.png)

## [](#_observation)Observation

Observation is a feature of the Java Content Repository that enables applications to register interest in events that describe changes to a workspace. The applications can then monitor and respond to those events. The observation mechanism dispatches events when a persistent change is made to the workspace. Magnolia uses observation heavily. For instance, observation is used to reload module configurations and to reload all objects provided by the FactoryUtil. To use observation you must at least specify the workspace, the path to the node which should be observed, and an event listener. The event listener’s `onEvent()` method is called whenever there are changes in the observed node.

Magnolia provides the info.magnolia.observation.WorkspaceEventListenerRegistration helper class to assist you in using observation for your project. info.magnolia.cms.util.ObservationUtil has been deprecated since Magnolia 5.4.6.

## [](#_node2bean)Node2Bean

Most configuration is stored in the config workspace. To transfer the repository stored configuration into a Java object, a mechanism called Node2Bean is used. Node2Bean populates a Java Bean from the content of a repository node including sub nodes. Note that configuration details are not restricted to the config node. The following table shows where the Node2Bean mechanism is currently used.

 Where it’s usedWhat is configured

info.magnolia.cms.beans.config.ServerConfiguration

Basic server configuration: `defaultBaseURL`, `defaultExtension`, `instanceUuid`, etc.

> **Note:** defaultBaseURL is the default base URL of the server root. The property is used to create absolute links in emails or other external systems.

info.magnolia.cms.beans.config.VirtualURIManager

Mapping virtual URIs to pages.

info.magnolia.cms.filters.FilterManagerImpl

Filter chain

info.magnolia.cms.i18n.DefaultMessagesManager

Messages for localized labels and descriptions in the UI.

info.magnolia.commands.CommandsManager

[Commands](../../../Developing/Commands/) and command catalogs.

info.magnolia.module.ModuleManagerImpl

Module definitions

info.magnolia.objectfactory.ConfiguredComponentFactory

Builds a component configured in the repository.

info.magnolia.objectfactory.ObservedComponentFactory

info.magnolia.objectfactory.guice.GuiceConfiguredComponentProvider

Guice Provider that creates an object by reading it from the repository.

info.magnolia.rendering.renderer.registry.ConfiguredRendererProvider

RendererProvider that instantiates a renderer from a configuration node.

info.magnolia.rendering.template.registry.ConfiguredTemplateDefinitionProvider

`TemplateDefinitionProvider` that instantiates a template from a configuration node.

> **Important:** For developers, module configuration (ModuleManagerlmpl) using the module class is the most important current usage of Content2Bean.

### [](#_node2bean_in_module_instances)Node2Bean in module instances

Module configuration data is transferred into a Bean from `/modules/<module name>/config`. The Bean class to build is defined in the module descriptor XML file.

```xml
<!DOCTYPE module SYSTEM "module.dtd">
  <module>
    <name>samples</name>
    <displayName>Magnolia Samples Module </displayName>
    <class>
      info.magnolia.module.samples.SamplesModule
    </class>
```

**Components**. If a path in the config workspace is given rather than a concrete class name, then Node2Bean is used to build the component instance.

```none
# Map to a path in the config workspace
info.magnolia.cms.i18n.I18nContentSupport = /server/i18n/content
```

**Additional items** such as components, templates and virtual URI mappings are configured at module level.

### [](#_data_types)Data types

`Node2Bean` analyzes the bean’s `setter` and `adder` methods using introspection and uses them if a suitable configuration value is available. With the `adder` methods (using the singular form of the node names), you can populate collections and maps. With this mechanism, `Node2Bean` can support all possible data types:

-   Simple data types like `string`, `int`, `long`, `float`, `double`, or `boolean` (to specify `true`, you can use `true`, `TRUE`, or `1`) with the suitable `setter` method

-   Other data types matching the `setter` method’s signature

-   Collections with `string` values or other data types by specifying a class property

-   Maps with keys and values as `strings` or other data types by specifying a class property


All sub-elements are also built using `Node2Bean`.

### [](#_classes)Classes

The class used to instantiate an object through the Node2Bean mechanism is determined through reflection or by explicitly referencing a class in the class node data. By referencing a specific class, you can override Magnolia default configuration and implement your own caching behavior, security mechanism and so on.

![A diagram of Node2Bean](../../../_images/diagram-node2bean.png)

Numbered items:

1.  `config`: Entry point of the transformation. In the module descriptor `SampleConfig` class is used. Set `text` and `number` properties.

2.  `sub`: Subbean. The class is determined using reflection if it isn’t explicitly defined.

3.  `items`: Collection. The corresponding `add` method is used to determine the class and populate the collection if existing.

4.  `item2`: Special item with its own class and additional properties.

5.  `parameters`: Collection of key-value pairs.


### [](#_simple_data_types)Simple data types

Values with simple data types must be defined as properties. Each property name must match its respective setter method.

### [](#_collections)Collections

To configure a collection you have to create a sub node and a suitable `setter` method:

-   All properties of the collection node create simple String entries in the collection. The properties' names aren’t used by Node2Bean, only the values.

-   All sub nodes of the collection node are treated as objects of the type specified in the `class` property in the sub node. If no class attribute is specified, a Map is created instead. The sub nodes' names aren’t used by Node2Bean.

-   All sub nodes of the collection node are treated as maps unless they have a `.`. The properties' names and the sub nodes' names are not used by Node2Bean.


### [](#_maps)Maps

The rules to populate a map are the same as with collections, except that the properties' names and the sub nodes' names are used as key values.

### [](#_example_cache_configuration)Example: Cache configuration

The configuration creates an object of the type info.magnolia.module.cache.ContentCachingConfiguration. This class needs public setter or adder methods.

```java
 public void setCachePolicy(CachePolicy cachePolicy);
    public void setFlushPolicy(FlushPolicy flushPolicy);
    public void setBrowserCachePolicy(BrowserCachePolicy browserCachePolicy);
    public void setExecutors(Map executors);
    public void addExecutor(String name, CachePolicyExecutor executor);
```

Note, that all necessary setters are available. For the `executors` node, there are setter and adder methods. As the adder is more specific, the `setExecutors` method isn’t used.

![Cache configuration management](../../../_images/ADVT-configmgt-cahe1.png)

This is what happens with `setCachePolicy(CachePolicy cachePolicy)`:

![setCachePolicy configuration management](../../../_images/ADVT-configmgt-cahe2.png)

Since there is a class property defined, let’s look at the info.magnolia.module.cache.cachepolicy.Default class that Node2Bean uses to create the new object.

```java
public void setVoters(VoterSet voters);
```

Now, let’s have a look at the `addExecutor(String name, CachePolicyExecutor executor)` method in `ContentCachingConfiguration`:

![addExecutor method applied](../../../_images/ADVT-configmgt-cahe3.png)

As this method has two arguments, the node name `bypass` is passed as the first argument and a `Bypass` object as the second argument. Because `CachePolicyExecutor` is an interface, the implementing class is specified.

## [](#_voters)Voters

Voters are used in Magnolia whenever configuration values aren’t assigned at startup but instead depend on rules. For example the cache module has to determine if a requested resource may be cached or not. The rules to determine values should be configurable. The rules are user-defined using voters which evaluate established criteria by determining *true* or *false* of each rule. Voters are currently used for:

-   Filter configuration: uses voters to determine whether a filter should be executed or bypassed.

-   Cache configuration: uses voters to determine whether a file should be cached or not.


The basic concept of voters uses Voter classes which calculate an `int` vote value, where positive (1, 2, 3, …) results are treated as `yes` or `true` and (0, -1, -2, …) results are treated as `no` or `false`. If you have a set of voters, then the result of a voting is the largest absolute result. If there are two voters with the same absolute result, then the one with the higher positive value is taken.

Examples:

| Vote results | VoterSet result |
| --- | --- |
| \-3, 0, 2 | \-3 |
| \-3, 0, 3 | 3   |
| \-3, 0, 4 | 4   |

For most of the `real world` voters only boolean results make sense. These boolean voters return ``1'' for a `true'' and` 0`` for a `false` result.

### [](#_voter_examples)Voter examples

<div class="joplin-table-wrapper"><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 20%;"> <col style="width: 30%;"> <col style="width: 10%;"> <col style="width: 40%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Voter</th><th class="tableblock halign-left valign-top">Parameters</th><th class="tableblock halign-left valign-top">Boolean</th><th class="tableblock halign-left valign-top">Description</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="inlineBean">info.magnolia.voting.voters.AuthenticatedVoter</span></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>none</p></div></div></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p>Checks if the current user is authenticated.</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><span class="inlineBean">info.magnolia.voting.voters.ExtensionVoter</span></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="ulist"><ul><li><p>allow: comma separated lists of allowed extensions.</p></li><li><p>deny: comma separated lists of denied extensions.</p></li></ul></div></div></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="ulist"><ul><li><p>Returns false if the extension isn’t a valid mimetype (as configured in <code>config:/server/MIMEMapping</code>.</p></li><li><p>Returns false if the allow list exists, but the extension isn’t in the allow list.</p></li><li><p>Returns false if the deny list exists and the extension is in the deny list.</p></li><li><p>Returns true in any other cases.</p></li></ul></div></div></td></tr></tbody></table></div>

> **Tip:** For further information, see the voters package summary.
