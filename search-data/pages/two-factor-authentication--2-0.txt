---
title: "Two Factor Authentication module"
url: https://docs.magnolia-cms.com/two-factor-authentication/2.0/
category: Modules
version: modules
breadcrumb: Two Factor Authentication module
---

# Two Factor Authentication module

[Incubator](https://gitlab.magnolia-platform.com/ps/incubator/two-factor-authentication) Version 2.0.0 [Magnolia 6.3](#6.3@product-docs:ROOT:index.adoc) compatible

The **Two Factor Authentication module** enables two factor authentication (2FA) via [Time-Based One-Time Password (TOTP)](https://datatracker.ietf.org/doc/html/rfc6238). for Magnolia’s default login form.

A private key is generated and sent to the sent to the user’s email as a QR code. The user scans this code in a suitable password generating app such as Google Authenticator, Microsoft Authenticator, or another 2FA tool.

On log in, users are required to enter the latest code generated by the app using their secret key. Only when the correct code is provided can the user log in.

## [](#_prerequisites)Prerequisites

-   You must have the [Mail module](../../product-docs/7.0/Modules/List-of-modules/Mail-module/) installed and the mail server configured in order to proceed.


> **Warning:** Administrators need to generate QR codes for users and verify them before enabling the 2FA feature.If you have already enabled two-factor authentication:Disable 2FA by decorating the module config.Generate the QR code for your user and add to a token generating application.Re-enable 2FA.

## [](#_installing_with_maven)Installing with Maven

Maven is the easiest way to install the module. Add the following to your [bundle](#6.3@product-docs:ROOT:Developing/Bundles-and-webapps.adoc):

```xml
<dependency>
  <groupId>info.magnolia.security</groupId>
  <artifactId>two-factor-authentication</artifactId>
  <version>2.0.0</version>
</dependency>
```

## [](#_configuration)Configuration

There are a few configuration areas that this module modifies.

-   Standard Magnolia [securityCallback](#_securitycallback)

-   Standard Magnolia [loginHandlers](#_loginhandlers)

-   Mail module [2faQrCodeEmailTemplate](#_2faqrcodeemailtemplate)

-   Two Factor Authentication module [Module Configuration](#_module_configuration)


* * *

### [](#_securitycallback)securityCallback

At `/server/filters/securityCallback/clientCallbacks/form/` the `loginForm` property is changed from:

```none
/defaultMagnoliaLoginForm/login.html
```

to

```none
/defaultMagnoliaLoginForm/2fa-login.html
```

At the same location, the `class` property is changed from:

```none
info.magnolia.cms.security.auth.callback.FormClientCallback
```

to

```none
info.magnolia.security.twofactorauth.auth.callback.TwoFactorAuthenticationFormClientCallback
```

### [](#_loginhandlers)loginHandlers

At `/server/filters/login/loginHandlers/Form` the `class` property is changed from:

```none
info.magnolia.cms.security.auth.login.FormLogin
```

to

```none
info.magnolia.security.twofactorauth.auth.login.TwoFactorAuthenticationFormLogin
```

### [](#_2faqrcodeemailtemplate)2faQrCodeEmailTemplate

This module provides a new email template, `2faQrCodeEmailTemplate`.

Configure `2faQrCodeEmailTemplate` at `/src/main/resources/two-factor-authentication/decorations/mail/config.yaml`.

| Property | Description |
| --- | --- |
| `from` | **required**<br><br>The `from` field specifies where the email is coming from and is sent to users when a code is generated for them. |
| `subject` | **required**<br><br>The `subject` line of the email that will be sent to users when a code is generated for them. |

### [](#_module_configuration)Module Configuration

| Property | Description |
| --- | --- |
| `enable2FA` | **required**<br><br>Flag to toggle on and off the requirement for a valid TOTP password at log in. |
| `optIssuer` | **required**<br><br>Name for the code issuer that will be displayed in the user’s password generating tool. |

## [](#_usage)Usage

This sections covers how to use the module.

### [](#_generate_token)Generate token

1.  In AdminCentral, go to the **Security** app.

2.  Go to **System Users**.

3.  Select the desired user.

    1.  In the edit panel, click **Generate Security Token**.

        ![2fa generate](_images/2fa-generate.png)



#### [](#_user_interaction)User interaction

Once the security token is generated, the selected user receives an email prompting them to scan an attached QR code with a one-time key generating tool.

![2fa email](_images/2fa-email.png)

### [](#_use_the_token)Use the token

For the flow to be completed:

1.  The user scans the QR code with their app.

2.  The user receives a time-sensitive code in their app.

3.  The user enters the code in the corresponding field of the Magnolia login screen.


![2fa login](_images/2fa-login.png)

## [](#_changelog)Changelog

<div class="joplin-table-wrapper"><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 20%;"> <col style="width: 80%;"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Version</th><th class="tableblock halign-left valign-top">Notes</th></tr></thead><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>2.0.0</code></code></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="ulist"><ul><li><p>Initial release (Magnolia 6.3 support)</p></li><li><p><a href="https://magnolia-cms.atlassian.net/issues/?jql=project%20%3D%20TWOFAUTH%20AND%20fixVersion%20%3D%202.0.0" target="_blank" rel="noopener">Changelog</a></p></li></ul></div></div></td></tr></tbody></table></div>
