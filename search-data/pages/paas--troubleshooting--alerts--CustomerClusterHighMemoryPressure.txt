---
title: "Cluster high memory pressure"
url: https://docs.magnolia-cms.com/paas/troubleshooting/alerts/CustomerClusterHighMemoryPressure/
category: DX Cloud
version: cloud
breadcrumb: DX Cloud > Troubleshoot > Cluster high memory pressure
---

# Cluster high memory pressure

## [](#_symptom)Symptom

A `CustomerClusterHighMemoryPressure` alert is firing. It indicates a filesystem on a node in your cluster is almost full.

> **Note:** CustomerClusterHighMemoryPressure alerts are sent to subscribers via email.

Memory pressure and nodes

Cluster nodes can suffer from memory pressure (less than `5%` memory available and a high rate of major page faults used by the alerts), but the cluster may have lots of unused memory. The pod distribution across the cluster node may be uneven with one node getting the memory hungry pods while other nodes are lightly loaded.

## [](#_observations)Observations

Here are the details on the alerts:

### [](#_alert_customerclusterhighmemorypressure)Alert: CustomerClusterHighMemoryPressure

<div class="joplin-table-wrapper"><table class="tableblock frame-all grid-all stretch"><colgroup><col style="width: 15%;"> <col style="width: 85%;"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Expression</strong></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><code>instance:node_memory_available:ratio * 100 &lt; 5 and rate(node_vmstat_pgmajfault[2m]) &gt; 1000</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Delay</strong></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><code>15</code> minutes</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Labels</strong></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph"><p><code>team: customer</code></p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Annotations</strong></p></td><td class="tableblock halign-left valign-top"><div class="content"><div class="ulist"><ul><li><p><code>summary</code></p></li><li><p><code>description</code></p></li><li><p><code>tenant</code></p></li><li><p><code>cluster_id</code></p></li><li><p><code>cluster_name</code></p></li><li><p><code>instance</code></p></li></ul></div></div></td></tr></tbody></table></div>

### [](#_determine_the_node_with_high_memory_pressure)Determine the node with high memory pressure

The alert contains:

-   the cluster name/id (the `k8s_cluster_name` and `k8s_cluster_id` labels)

-   the cluster node (the instance label)

-   the device (the device label)

-   the filesystem (the mountpoint label)


> **Important:** It’s important to note the label values from the alert.

## [](#_solutions)Solutions

This section provides solutions that should help resolve the issue in most cases.

### [](#_increase_cluster_node_instance_type)Increase cluster node instance type

The memory available to a cluster node is determined by the instance type. Cluster nodes are usually `t3a-xlarge` EC2 instances with `16GB` memory. The next larger instance type, `t3a.2xlarge`, has `32GB` memory. There are no instance types larger than `t3a.2xlarge`.

Cost increase

Increasing the instance type means you will have to pay for the larger instances.

> **Important:** All nodes in the cluster should be upgraded if the instance type is increased!

The instance type of the cluster nodes can be changed in AWS. Magnolia deployments will be unavailable while the node instance type is upgraded.

### [](#_add_a_node_to_the_cluster)Add a node to the cluster

We recommend that each Magnolia instance and its database be run on a separate node in the cluster: the `author` plus two `public` instances can each be run on separate nodes and each Magnolia instance can have enough memory (`10 - 12 GB` for author instances and `8 - 10 GB` for public instances).

If you want to run more than three Magnolia instances on the cluster, additional nodes can be added to the cluster.

Cost increase

You have to pay more to increase the number of nodes.

Adding a node to cluster won’t necessarily redistribute the workloads more evenly across the cluster.

You may need to redeploy Magnolia after adding a cluster node.
