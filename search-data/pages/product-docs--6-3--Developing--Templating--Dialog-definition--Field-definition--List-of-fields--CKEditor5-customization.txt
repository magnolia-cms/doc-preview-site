---
title: "CKEditor 5 customization"
url: https://docs.magnolia-cms.com/product-docs/6.3/Developing/Templating/Dialog-definition/Field-definition/List-of-fields/CKEditor5-customization/
category: Magnolia 6.3
version: 6.3
breadcrumb: DX Core > Developing > Templating > Rich text field > CKEditor 5 customization
---

# CKEditor 5 customization

For Magnolia 6.3 installations, CKEditor 5 is the default rich text field. This page outlines how to build your editor, install it in Magnolia, and customize it for your needs.

A Magnolia instance includes one CKEditor 5 build, which may contain several editor types for pages requiring different editor configurations.

## [](#_ckeditor_4_migration_to_ckeditor_5)CKEditor 4 migration to CKEditor 5

Magnolia 6.2 uses CKEditor 4 in its rich text field. Magnolia 6.3 is released with CKEditor 5. While most field properties from Magnolia 6.2 are supported, CKEditor 4 and CKEditor 5 are very different in their [core architecture](https://ckeditor.com/docs/ckeditor5/latest/updating/ckeditor4/migration-from-ckeditor-4.html#differences-between-ckeditor-4-and-ckeditor-5). For this reason, Magnolia recommends previewing any content transferred from CKEditor 4 in Magnolia 6.2 and checking that the content is published as you want it.

In particular, you should check their compatibility tables for [configuration](https://ckeditor.com/docs/ckeditor5/latest/updating/ckeditor4/ckeditor4-configuration-compatibility.html) and [plugins](https://ckeditor.com/docs/ckeditor5/latest/updating/ckeditor4/ckeditor4-plugin-compatibility.html) to determine which content might be affected. Furthermore, follow their [migration guidelines](https://ckeditor.com/docs/ckeditor5/latest/updating/ckeditor4/migration-from-ckeditor-4.html) to ensure a smooth transition of any content.

### [](#_plugins_in_the_magnolia_ckeditor5_build)Plugins in the Magnolia `ckeditor5-build`

For a list of plugins included in the Magnolia `ckeditor5-build`, see [`ckeditor5.ts`](https://gitlab.com/magnolia-ce/ckeditor5-plugins/-/blob/main/packages/ckeditor5-build/src/ckeditor5.ts?ref_type=heads).

> **Warning:** If you use a custom build, Magnolia will ignore all the other configured properties in the rich text field.

## [](#_using_a_custom_build)Using a custom build

Before getting started, ensure your custom CKEditor 5 build aligns with the version included in your Magnolia installation. Specifically, Magnolia 6.3.0 and later strictly requires `41.x`, not higher.

For more complex customizations (different plugins, editor types, and so on), you can replace the CKEditor 5 provided by Magnolia with your custom build by setting the MicroProfile property `magnolia.ckeditor5.build` to a light-module resource (for example, `/custom-lm/webresources/ckeditor5.js`) or an absolute URL.

### [](#_clone_a_pre_built_project)Clone a pre-built project

For the quickest setup, clone the pre-built CKEditor 5 project designed for version `41.x`. This approach is also known as the [Legacy installation method](https://ckeditor.com/docs/ckeditor5/latest/getting-started/legacy/installation-methods/quick-start-other.html) in the official CKEditor 5 documentation.

**Example in the steps below**: Add Magnolia’s link plugins

1.  Ensure you have [Node.js or Node](../../../../../../Getting-started-with-Magnolia/Installing-Magnolia/Installing-Magnolia-through-npm-CLI/#_get_nodejs_and_npm) installed.

2.  Clone the [ckeditor5-plugins](https://gitlab.com/magnolia-ce/ckeditor5-plugins) project from GitLab.

3.  Add plugins via `npm` or manually add them to the [CKEditor build](https://gitlab.com/magnolia-ce/ckeditor5-plugins/-/tree/main/packages/ckeditor5-build).

    -   Use the `npm install` command, for example:

        ```console
        npm add @magnolia/ckeditor5-plugins
        ```

    -   Or manually add the plugin to the dependencies section of the package file `packages/ckeditor5-build/package.json`:

        ```json
        "dependencies": {
          //other dependencies ...
          "@magnolia/ckeditor5-plugins": "^1.0.5"
        }
        ```

        > **Tip:** For a complete list of CKEditor plugins, see CKEditor plugins.


4.  To enable `MgnlLink` functionality, import it from the package and add it into your editor’s plugins. Additionally, ensure you add the respective controls into your editor configuration’s toolbar items.

    -   Locate the `ckeditor5.ts` file under `packages/ckeditor5-build/src`.

    -   Add an import statement and reference it in `BUILTIN_PLUGINS` in the `ckeditor5.ts` file:

        ```none
        ...
        import { MgnlLink } from '@magnolia/ckeditor5-plugins';

        const BUILTIN_PLUGINS = [
          ...
          MgnlLink
        ];
        ...
        ```

    -   Add the plugin to the toolbar:

        ```none
        ...
        const DEFAULT_CONFIG : EditorConfig = {
          toolbar: [
                     ...
                     '|',
                     'mgnlPagesLink',
                     'mgnlAssetsLink'
          ],
        ...
        ```

        > **Tip:** For more highlighting customization options, see CKEditor highlight options.


5.  [Rich text field](../Rich-text-field/) integration requires custom build editors to be exported as `CKEDITOR5`. Configure the output library in your webpack accordingly.

    ```none
    output: {
      library: 'CKEDITOR5'
    ```

6.  Export the editor by adding the export command at the end of the `ckeditor5.ts` file.

    ```none
    ...
    // Export the editor for CKEditor 5 to use in your project.
    export default { ClassicEditor };
    ...
    ```

7.  Rebuild the editor using the `npm run build` command.

8.  Find the `ckeditor5.js` file under `packages/ckeditor5-build/build`.

9.  Place the `ckeditor5.js` file into the `webresources` folder in a light module folder. For example, `/module-lm/webresources/ckeditor5.js`.

10.  Configure the `magnolia.ckeditor5.build` property with the path to the `ckeditor5.js` file.

     -   You can do this via a JVM parameter:

         ```none
         -Dmagnolia.ckeditor5.build=/module-lm/webresources/ckeditor5.js
         ```

     -   Or by defining it, for example `magnolia.ckeditor5.build=/module-lm/webresources/ckeditor5.js`, in the [MicroProfile Config](../../../../../../Administration/Architecture/configuration-management/microprofile-config/).


11.  Restart your Magnolia instance.


> **Tip:** JavaScript and CSS are bundled into a single file. Our custom build repository provides an example of how to achieve a custom build.

### [](#_using_multiple_editors)Using multiple editors

Once you have a custom bundle, which contains multiple editors, you can specify the `editorType` individually in your `richTextField` definitions. The steps to achieve this are outlined below.

1.  Create multiple editor classes and adjust their plugins and editor configs (toolbars).

2.  Export them, for example, `ClassicEditor` and `CustomEditor`, by adding an export statement, as shown in the example below.

    ckeditor5.ts

    ```typescript
    ...
    export default {
      ClassicEditor,
      CustomEditor
    };
    ```

3.  Remember to point to your custom ckeditor build placed in `webresources` (or can point to your Webpack dev server during development) by setting the MicroProfile property `magnolia.ckeditor5.build` to a light-module resource (for example, `/custom-lm/webresources/ckeditor5.js`) or an absolute URL.

4.  [Refer to the editors](#_including_the_custom_build_in_magnolia) via `editorType` in YAML definitions.


The exported editors can be retrieved by `CKEDITOR5["ClassicEditor"]` or `CKEDITOR5["CustomEditor"]`. For more details, see CKEditor’s documentation section: [Creating *super builds*](https://ckeditor.com/docs/ckeditor5/latest/getting-started/legacy/advanced/using-two-editors.html#creating-super-builds).

### [](#_general_html_support_plugin)General HTML Support plugin

Since the Magnolia 6.3.10 release, the Magnolia CKEditor 5 build also includes the [General HTML Support](https://ckeditor.com/docs/ckeditor5/latest/features/html/general-html-support.html) (GHS) plugin.

The main use cases for this plugin are:

-   Ensuring backward content compatibility with legacy systems.

-   Introducing basic support for missing HTML features at a low cost.


The plugin goes beyond common content formatting needs and also allows HTML elements like `<iframe>` and `<script>` in rich text fields.

> **Caution:** Activating these features may introduce security risks, including the possible execution of malicious code. For more details, see General HTML Support: Security.

#### [](#_enabling_the_iframe_tag_in_ghs)Enabling the `<iframe>` tag in GHS

To use tags such as `<iframe>` with its common attributes, update the `htmlSupport` section in the editor configuration.

ckeditor5.ts

```js
EditorConfig = {
  htmlSupport = {
        allow: [ (1)
            {
                name: 'iframe', (2)
                attributes: {
                    src: true,
                    width: true,
                    height: true,
                    frameborder: true,
                    allowfullscreen: true,
                    title: true
                },
                classes: true,
                styles: true
            }
        ],
        disallow: [] (3)
    };
}
```

|     |     |
| --- | --- |
| **1** | The `allow` array specifies which elements are permitted. |
| **2** | For <iframe>, attributes like <src>, <width>, <height>, <frameborder>, <allowfullscreen>, and <title> are commonly used and explicitly allowed here. |
| **3** | The <disallow> array can be used to block specific elements or attributes if needed. |

#### [](#_allowing_the_tag_in_a_field_validator)Allowing the tag in a field validator

Add the following to your global validator configuration or a dialog-specific YAML.

```yaml
defaultFieldValidators:
  info.magnolia.ui.field.RichTextFieldDefinition:
    safeHtml:
      class: info.magnolia.ui.field.SafeHtmlValidatorDefinition
      allowedTags: (1)
        a: a
        div: div
        p: p
        iframe: iframe
        # Add other allowed tags as needed
      allowedAttributes: (2)
        a:
          tag: a
          attributes: [href, target, title]
        iframe:
          tag: iframe
          attributes: [src, width, height, frameborder, allowfullscreen, title]
        # Add other tag attributes as needed
      allowedProtocols: (3)
        a:
          tag: a
          attribute: href
          protocols: [ftp, http, https, mailto]
        iframe:
          tag: iframe
          attribute: src
          protocols: [https] # Restrict to HTTPS for security
...
```

|     |     |
| --- | --- |
| **1** | `allowedTags`: Maps the tag names to their HTML equivalents. Here, `iframe: iframe` explicitly allows the tag in the HTML content. |
| **2** | `allowedAttributes`: For each tag, specifies the permitted attributes. For `iframe`, the attributes `src`, `width`, `height`, `frameborder`, `allowfullscreen`, and `title` are allowed, matching the CKEditor configuration. |
| **3** | `allowedProtocols`: Restricts the protocols for attributes like `src`. For the `iframe` tag, the `src` attribute is restricted to the `https` protocol to ensure secure content loading. Additional protocols, such as `http`, may be permitted for testing purposes, but HTTPS is strongly recommended in production to mitigate security risks. |

#### [](#_handling_non_standard_html_elements_in_ghs)Handling non-standard HTML elements in GHS

To support non-standard HTML elements (for example, `map`, `area`, `style`) in CKEditor 5, enable `htmlSupport` to allow all elements, attributes, classes, and inline styles in the editor, and then specify the tags and attributes allowed in rendering.

1.  Enable all elements and attributes in CKEditor 5.

    ```js
    htmlSupport: {
      allow: [
        {
          name: /.*/,           // Allows all tags
          attributes: true,     // Allows all attributes for all tags
          classes: true,        // Allows all classes for all tags
          styles: true          // Allows all inline styles for all tags
        }
      ]
    }
    ```

2.  Specify the desired allowed tags in `/ui-framework-core/config.yaml`.

    ```yaml
    allowedTags:
      map: map
      area: area
      # Add more as needed
      # style: style
    ```

3.  Specify the desire allowed attributes in `/ui-framework-core/config.yaml`.

    ```yaml
    allowedAttributes:
      map:
        tag: map
        attributes: [name]
      area:
        tag: area
        attributes: [shape, coords, href, alt]
      # Add more as needed
      # style:
      #   tag: style
      #   attributes: []
    ```


## [](#_including_the_custom_build_in_magnolia)Including the custom build in Magnolia

Once your custom build is configured, use the `editorType` property to specify which editor from the ones included in the build you want to use.

```yaml
form:
  properties:
    text:
      $type: richTextField
      editorType: ClassicEditor
```

## [](#_authoring_your_text)Authoring your text

This page assumes you installed a Classic CKEditor. Your CKEditor toolbar should look similar to the one above the CKEditor demo page below.

![Apps configuration](../../../../../../_images/cke5-demoClassicEditor.png)

A customized CKEditor 5 build also contains two additional Magnolia plugins. They allow you to link to assets and pages in Magnolia.

  PluginIconDescription

**Link to Magnolia page**

![Link to Magnolia page](../../../../../../_images/rich-text-field-toolbar/link-to-page.png)

Opens a chooser dialog where you can link to a page in the `website` workspace.

> **Note:** When linking to a page fragment, the fragment identifier (such as #element-id or #:~:text=…​) must be appended after the closing brace of the ${link:{…​}} object. You can do this in the properties subdialog of the page link dialog.Don’t place the fragment inside the path property in the object, as the templating function can’t process it correctly.Correct usage example with #:~:text=Services as fragment:${link:{uuid:'808e...ce02f', repository:'website', path:'/travel/about'}}#:~:text=ServicesIncorrect usage:${link:{uuid:'...', path:'/travel/about#:~:text=Services'}}

**Link to asset**

![Link to DAM document](../../../../../../_images/rich-text-field-toolbar/link-to-dam.png)

Opens a chooser dialog where you can link to an asset in the `dam` workspace.

### [](#_mgnllink_plugin_customization)`MgnlLink` plugin customization

You can customize the `MgnlLink` plugin in Magnolia’s CKEditor 5 by adding decorations to the editor configuration.

#### [](#_the_target_and_rel_attributes)The `target` and `rel` attributes

To enable links to open in a new tab with security attributes, customize the `MgnlLink` plugin to include `rel` and `target` fields.

> **Note:** This decoration is included by default in the Magnolia ckeditor5-build in Magnolia 6.3.9 and later.

The following configuration adds the `openInNewTab` decorator:

ckeditor5.ts

```typescript
EditorConfig = {
  mgnllink: {
    decorators: {
      openInNewTab: { // Decorator ID
        mode: 'manual', // Required, must be 'manual'
        label: 'Open link in new tab', // Required, shown in the dialog
        attributes: { // Attributes applied to the link when the decorator is active
          rel: 'noopener noreferrer',
          target: '_blank'
        }
      }
    }
  }
}
```

This configuration adds the `rel` and `target` attributes to the `<a>` element, as shown below:

```html
<a href="{...}" rel="noopener noreferrer" target="_blank" class="ck-link_selected">Sportstation</a>
```

#### [](#_custom_decorations)Custom decorations

You can apply custom decorations to modify other link properties, such as styling. For example, the following configuration adds a `customStyle` decorator to change the link’s text color:

ckeditor5.ts

```typescript
EditorConfig = {
  mgnllink: {
    decorators: {
      customStyle: {
        mode: 'manual',
        label: 'Custom Style',
        attributes: { // Attributes applied to the link when the decorator is active
          style: 'color: red;'
        }
      }
    }
  }
}
```

This results in a link with a red text color:

```html
<a href="{...}" style="color: red;">Sportstation</a>
```

## [](#_previewing_the_html)Previewing the HTML

[Preview](../../../../../../Authoring/Editing-pages/#_previewing_pages) your content to see how the plugins used by CKEditor 5 render it on the final webpage.

Related topics

-   [Rich text field](../Rich-text-field/)

-   [Light rich text field](../../../../../../Modules/List-of-modules/Content-Editor-module/Light-rich-text-field/)
