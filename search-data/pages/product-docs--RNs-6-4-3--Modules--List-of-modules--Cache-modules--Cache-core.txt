---
title: "Cache core"
url: https://docs.magnolia-cms.com/product-docs/RNs-6-4-3/Modules/List-of-modules/Cache-modules/Cache-core/
category: Magnolia 6.4
version: latest
breadcrumb: DX Core > Modules > Cache modules > Cache core
---

# Cache core

| Edition | CE, Cloud |
| --- | --- |
| License | [MLA](https://www.magnolia-cms.com/mla.html) , [GPL](http://www.gnu.org/licenses/gpl-3.0.html) |
| Issues | [MGNLCACHE](https://magnolia-cms.atlassian.net/browse/MGNLCACHE) |
| Maven site | [Cache](https://nexus.magnolia-cms.com/#browse/browse:public:info%2Fmagnolia%2Fcache%2Fmagnolia-cache-core%2F{magnolia-module-cache-64}) |
| Latest | {magnolia-module-cache-64} |

## [](#_installing_with_maven)Installing with Maven

Maven is the easiest way to install the module. Add the following to your [bundle](../../../../Developing/Bundles-and-webapps/):

```xml
<dependency>
  <groupId>info.magnolia.cache</groupId>
  <artifactId>magnolia-cache-core</artifactId>
  <version>{magnolia-module-cache-64}</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

| Node name | Value |
| --- | --- |
| üìÅ server |  |
| üìÅ filters |  |
| üìÅ cache |  |
| ‚¨© defaultContentCachingConfigurationName | defaultPageCache |
| ‚¨© class | info.magnolia.module.cache.filter.CacheFilter |
| ‚¨© enabled | false |

## [](#_how_caching_works)How caching works

Caching is performed by the [Cache filter](../../../../Administration/Architecture/Request-processing-and-filters/Filters/), which is part of the standard Magnolia [filter chain](../../../../Administration/Architecture/Request-processing-and-filters/Filters/). When a request arrives to the Cache filter, the filter passes it to the browser cache policy.

-   **Content not modified**: If a client has the latest version of content (i.e. not modified), the browser cache policy instructs the filter to respond with `304 Not Modified`.

-   **Modified content**: If content has been modified or does not exist in the cache, the filter passes the request to the server cache policy. Server cache policy then analyzes the request and replies with the expected behavior. The filter then invokes the appropriate executor. This mechanism allows you to add, remove and use executors by changing the current cache policy.

-   **Content not available**: If the content is not available, the filter passes the request on to Magnolia. On the return trip, the filter reads the content from the response and stores it in the cache store for future use. Flush policy is completely independent of this chain and reacts on content changes rather than content served.


![Request processing and filter chain in Magnolia](../../../../_images/6-2-requestProcessing.png)

| Node name | Value |
| --- | --- |
| üìÅ modules |  |
| üìÅ cache |  |
| üìÅ config |  |
| üìÅ contentCaching |  |
| ‚∏¨ defaultPageCache |  |
| ‚∏¨ uuid-key-mapping |  |
| ‚∏¨ compression |  |
| ‚∏¨ cacheFactory |  |
| ‚¨© cacheResponseThreshold | 1000 |

## [](#_commands)Commands

Cache related commands are in the `cache` catalog:

-   `flushAll`: Completely flushes all caches. (Note that the imaging workspace - which technically is not a cache - is not flushed with this command.)

-   `flushByUUID`: Completely flushes all entries related to a given UUID from all available caches. This command expects `repository` and `uuid` as parameters.

-   `flushNamedCache`: Completely flushes a cache by name. Default cache names are `default` and `uuid-key-mapping`.


## [](#_cached_urls)Cached URLs

By default, the following URLs are cached:

-   On public instance everything except `/.magnolia/*` which is AdminCentral.

-   On author instance all static resources `/.resources/*` if `magnolia.develop` property is set to `false`.


| Node name | Value |
| --- | --- |
| üìÅ cache |  |
| üìÅ config |  |
| üìÅ contentCaching |  |
| ‚∏¨ cachePolicy |  |
| ‚∏¨ shouldBypassVoters |  |
| ‚∏¨ urls |  |
| ‚∏¨ includes |  |
| ‚∏¨ excludes |  |
| ‚∏¨ dotMagnolia |  |
| ‚¨© class | info.magnolia.voting.voters.URIStartsWithVoter |
| ‚¨© pattern | /.magnolia |
| ‚¨© not | true |
| ‚¨© level | 1 |

## [](#_setting_cache_headers)Setting cache headers

Cache header negotiation uses standard cache response headers. Cache needs to be enabled for the site or cache headers have no effect on the server side cache. The mechanism is built into the Cache module and requires no extra modules. Cache header negotiation is being introduced to Magnolia in two phases:

### [](#_in_code)In code

In code, developers set the cache headers in the rendering model of a component or a template. This is the current implementation.

**Example 1**: Setting a cache header in Java code, snippet from info.magnolia.module.form.templates.components.AbstractFormModel.

MgnlContext.getWebContext().getResponse().setHeader("Cache-Control", "no-cache");

**Example 2**: Setting a cache header in a FreeMarker template script.

${ctx.response.setHeader("Cache-Control", "no-cache")}

### [](#_in_page_properties_dialog)In page properties dialog

Since the release of Magnolia 6.2.2, the `basic` page [template in the Magnolia Templating Kit](../../../../Developing/Templating/Templates-in-MTK/) (MTK) allows you to control page caching through the **No Cache** checkbox in the Page properties dialog (the **Meta Data** tab):

![Page properties dialog](../../../../_images/6-2-30-cacheCore-noCacheCheckboxBoxed.png)

The checkbox is defined using the `noCache` field in the [basic.yaml](https://gitlab.magnolia-platform.com/pd/modules/templating-essentials/-/blob/master/magnolia-templating-kit-2/src/main/resources/mtk2/dialogs/pages/basic.yaml) dialog definition file. If checked, the [htmlHeader.ftl](https://gitlab.magnolia-platform.com/pd/modules/templating-essentials/-/blob/master/magnolia-templating-kit-2/src/main/resources/mtk2/templates/areas/htmlHeader.ftl) area template script sets the header.

### [](#_enhanced_private_cache_control_header)Enhanced `private` Cache-Control header

To prevent caching of sensitive form data, use the `private` directive in the `Cache-Control` header, such as `private, no-cache, no-store`.

**Examples**

Setting a cache header with the `private` directive in Java code:

```java
MgnlContext.getWebContext().getResponse().setHeader("Cache-Control", "private, no-cache, no-store");
```

Setting a cache header with the `private` directive in a FreeMarker template script:

```xml
${ctx.response.setHeader("Cache-Control", "private, no-cache, no-store")}
```

## [](#_security_aspects)Security aspects

### [](#_web_cache_poisoning)Web Cache Poisoning

When creating page templates, developers often need to use various types of input such as

-   content,

-   language,

-   request parameters,

-   user information (for authentication).


Magnolia takes care of all of these attributes and includes them in cache keys to ensure that unique cache entries are generated for all attribute variants occurring.

Sometimes, however, it may be unavoidable to use more exotic or less obvious variables such as specific header values, date/time values or other types of input. When using such parameters, developers must consider their impact on the validity of cache to prevent [Web Cache Poisoning](https://portswigger.net/research/practical-web-cache-poisoning) attacks.

#### [](#_example)Example

Imagine using an [HTTP referer](https://en.wikipedia.org/wiki/HTTP_referer) header to change a teaser image link on a page. Once the image is rendered, it is - by default - cached and used for all the other incoming requests,

-   as long as the cache entry is valid,

-   and regardless of referer headers of those requests.


Depending on the content rendered it might or might not be an issue, but a case of Web Cache Poisoning occurs if somebody passes malicious content through a referer header that is trusted by and rendered for all the other incoming requests.

#### [](#_prevention)Prevention

Always consider the character and the origin of the input entering the process of rendering a response. For any original request input,

-   either the input must be included in the cache key, to allow Magnolia to generate an independent cache entry from it,

-   or the component rendering such content needs to be marked as dynamic and excluded from the cache (see [Dynamic page caching](../../High-performance-caching-modules/Advanced-Cache-Dynamic-Page-Caching/#_dynamic_page_caching) for more details),

-   or else the whole page needs to be excluded from the cache.
