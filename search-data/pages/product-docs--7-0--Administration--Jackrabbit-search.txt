---
title: "Jackrabbit search"
url: https://docs.magnolia-cms.com/product-docs/7.0/Administration/Jackrabbit-search/
category: Magnolia 6.4
version: latest
breadcrumb: DX Core > Administration > Configuring search in Magnolia > Jackrabbit search
---

# Jackrabbit search

By default Magnolia’s search functionality is provided by the Jackrabbit repository and this page describes the configuration options for Jackrabbit-based search. For more advanced search options and especially if you need to manage high volumes of [assets](../../../RNs-6-4-3/Authoring/Managing-assets/#_how_to_handle_large_amount_of_assets) you can set up Magnolia to use Apache Solr, see [Solr search](../../../RNs-6-4-3/Features/Search/Solr-search/).

## [](#_how_search_indexing_works)How search indexing works

A workspace needs to be indexed in order to make information retrieval fast and accurate. Indexing is the process of collecting and parsing content, and storing the data in an index to make it easier and faster to retrieve requested portions of the data.

Magnolia search is based on the default [Jackrabbit search implementation](http://jackrabbit.apache.org/jcr/search-implementation.html). Jackrabbit uses an [Apache Lucene-based](http://lucene.apache.org/) indexer to process the data stored in the JCR. Node names and property values are indexed immediately and stored in the repository. Text from documents is extracted in a background process which makes document content searchable after a short delay.

Each Magnolia instance has its own repository and its own index. This means that the author instance index is typically different from public instance indexes. Any content that has not been published to a public instance cannot be found when running a search on that public instance.

## [](#_magnolia_index_configuration)Magnolia index configuration

Magnolia uses a custom Jackrabbit/Lucene indexing configuration. The indexing configuration file is in the Magnolia Core module in `/src/main/resources/info/magnolia/jackrabbit` and `org.apache.jackrabbit.core.query.lucene.SearchIndex` gets it from the classpath.

The generic indexing configuration used for all [workspaces](../../../RNs-6-4-3/Administration/Architecture/Workspaces/) *except* the `website` workspace is stored in `/info/magnolia/jackrabbit/indexing_configuration_default.xml`. The indexing configuration for the [website workspace](#_website_indexing_configuration_file) is in `/info/magnolia/jackrabbit/indexing_configuration_website.xml`. You can configure indexing for additional workspaces by setting the workspace name in `<param name="indexingConfiguration" value="/info/magnolia/jackrabbit/indexing_configuration_${wsp.name}.xml"/>` in the `workspace.xml` configuration file.

These configurations fine-tune the default Jackrabbit search configuration for best results. The sections that follow detail the enhancements. See also [Search index configuration file](../../../../performance-tuning/Search-and-indexing/Search-index-configuration-file/#_configuration_files) for more information.

> **Tip:** Special charactersJackrabbit stores all character data (node names and values) in Unicode. This ensures that special characters such as accents and umlauts are indexed and can be used in search. Issues with special characters are often due to character set conversion problems in the application server.

### [](#_website_indexing_configuration_file)Website indexing configuration file

The website indexing and generic indexing configuration files are configured in the Magnolia Core module in `/src/main/resources/info/magnolia/jackrabbit`. The indexing configuration has been improved to include new entries for `contentNodes`. These additions make them searchable in the Global Search and in-app search forms.

If you want to add this configuration yourself to an earlier Magnolia version, you can add the highlighted new entries in the configuration example below.

Default indexing\_configuration\_website.xml file

```xml
</index-rule>
<index-rule nodeType="mgnl:page">
    <property boost="3.0">title</property>
    <canSkipProperty>mgnl:activationStatus</canSkipProperty> (1)
    <canSkipProperty>mgnl:lastActivated</canSkipProperty> (1)
    <canSkipProperty>mgnl:lastActivatedBy</canSkipProperty> (1)
    <canSkipProperty>mgnl:lastActivatedVersion</canSkipProperty> (1)
    <canSkipProperty>mgnl:lastActivatedVersionCreated</canSkipProperty> (1)
</index-rule>

<index-rule nodeType="mgnl:area">
<excludeProperty>mgnl:activationStatus</excludeProperty> (2)
<excludeProperty>mgnl:lastActivated</excludeProperty> (2)
<excludeProperty>mgnl:lastActivatedBy</excludeProperty> (2)
</index-rule>
<index-rule nodeType="mgnl:component">
<excludeProperty>mgnl:activationStatus</excludeProperty> (2)
<excludeProperty>mgnl:lastActivated</excludeProperty> (2)
<excludeProperty>mgnl:lastActivatedBy</excludeProperty> (2)
</index-rule>
<index-rule nodeType="mgnl:contentNode">
<excludeProperty>mgnl:activationStatus</excludeProperty> (3)
<excludeProperty>mgnl:lastActivated</excludeProperty> (3)
<excludeProperty>mgnl:lastActivatedBy</excludeProperty> (3)
</index-rule>

<aggregate primaryType="mgnl:page">
<include primaryType="mgnl:area">*</include>
<include primaryType="mgnl:component">*</include>
<include primaryType="mgnl:contentNode">*</include> (4)
</aggregate>

<aggregate primaryType="mgnl:area" recursive="true" root="false"> (6)
<include primaryType="mgnl:component">*</include>
<include primaryType="mgnl:area">*</include> (5)
<include primaryType="mgnl:contentNode">*</include> (4)
</aggregate>

<aggregate primaryType="mgnl:component" recursive="true" root="false"> (6)
<include primaryType="mgnl:area">*</include>
<include primaryType="mgnl:component">*</include> (5)
<include primaryType="mgnl:contentNode">*</include> (4)
</aggregate>

<aggregate primaryType="mgnl:contentNode" recursive="true" root="false"> (6)
<include primaryType="mgnl:contentNode">*</include> (4) (5)
</aggregate>

</configuration>
```

|     |     |
| --- | --- |
| **1** | Indexing of these properties is bypassed only when the publishing metadata is updated. |
| **2** | Excludes specific properties from indexing. Explicitly defined for `mgnl:area` and `mgnl:component` because the `excludeProperty` doesn’t support inheritance or regular expressions, requiring separate index rules for each node type. |
| **3** | Excludes specific properties from indexing for `mgnl:contentNode` to optimize search performance by omitting irrelevant metadata. |
| **4** | New entries required to make content nodes searchable. |
| **5** | Areas, components, contentNodes can be nested. See [Configuration files](../../../../performance-tuning/Search-and-indexing/Search-index-configuration-file/#_configuration_files) for details on recursion and nested areas. |
| **6** | The `root` attribute (default `true`) can be set to `false`. When `false`, the node index is created with only the content it contains, and is used only for nested aggregation (for example in a `mgnl:page`). This helps create a lighter full-text search index. |

> **Note:** When you add aggregates, it can increase your index size when indexing and reindexing.

The location of the website’s indexing configuration file, [workspace.xml](../Architecture/Workspaces/workspace-configuration/), is configured in the instance property `magnolia.repositories.home`.

repositories/magnolia/workspaces/website/workspace.xml

```xml
...
<SearchIndex class="info.magnolia.jackrabbit.lucene.SearchIndex">
    <param name="path" value="${wsp.home}/index"/>
    <param name="indexingConfiguration" value="/info/magnolia/jackrabbit/indexing_configuration_${wsp.name}.xml"/> (1)
...
```

|     |     |
| --- | --- |
| **1** | The `SearchIndex` takes the indexing configuration from the classpath if it isn’t found in the workspace home. |

### [](#_excluding_nodes)Excluding nodes

Magnolia typically stores many properties, such as author, modification dates, templates etc., that are not relevant in search results. To minimize the index and speed-up search, all properties starting with `jcr:` or `mgnl:` are excluded from the index. This means you get fewer results but those results are more relevant.

```cnd
<index-rule nodeType="nt:base">
    <property isRegexp="true" nodeScopeIndex="false">mgnl:.*</property>
    <property isRegexp="true" nodeScopeIndex="false">jcr:.*</property>
    <property isRegexp="true">.*:.*</property>
</index-rule>
```

### [](#_skipping_properties)Skipping properties

To optimize indexing and search performance, you can use the `canSkipProperty` and `excludeProperty` rules to exclude specific properties from an indexing task.

The `canSkipProperty` rule skips indexing only when publishing metadata is updated, while the `excludeProperty` rule unconditionally blocks indexing.

In the example below, the listed properties are excluded when indexing nodes of type `mgnl:contentNode`.

```xml
...
<index-rule nodeType="mgnl:contentNode">
    <excludeProperty>mgnl:activationStatus</excludeProperty>
    <excludeProperty>mgnl:lastActivated</excludeProperty>
    <excludeProperty>mgnl:lastActivatedBy</excludeProperty>
</index-rule>
...
```

> **Note:** These optimization rules:Require info.magnolia.jackrabbit.lucene.MagnoliaIndexingConfiguration to be set in the basic workspace configuration via the indexingConfigurationClass parameter.Require magnolia.repositories.jackrabbit.indexing.optimization to be set to true (default value) in the magnolia.properties file of the respective Magnolia instance.Alternatively, you can also set it at the JVM level using the -D flag:-Dmagnolia.repositories.jackrabbit.indexing.optimization=trueBe aware that setting it via the -D overrides the setting defined in the configuration file.Don’t support inheritance or regular expressions.

### [](#_boosting_the_title_property)Boosting the title property

By default, indexing configuration boosts the `title` property of the `mgnl:page` node type since page titles are important.

```cnd
<index-rule nodeType="mgnl:page">
   <property boost="3.0">title</property>
</index-rule>
```

### [](#_including_areas_and_components)Including areas and components

The configuration uses [index aggregates](../../../RNs-6-4-3/Administration/Troubleshooting/Custom_nodetypes-xml-file/) to ensure area and component content is included in the index. The properties of `mgnl:area` and `mgnl:component` make up most of page content and need to be included explicitly. The aggregate also simplifies searching for content within pages.

Nested areas are also included using the `recursive` flag.

```xml
<aggregate primaryType="mgnl:page">
    <include primaryType="mgnl:area">*</include>
    <include primaryType="mgnl:component">*</include>
</aggregate>

<!-- areas can be nested. See http://wiki.apache.org/jackrabbit/IndexingConfiguration for recursion -->
<aggregate primaryType="mgnl:area" recursive="true" root="false"> (1)
    <include primaryType="mgnl:component">*</include>
    <include primaryType="mgnl:area">*</include>
</aggregate>
```

|     |     |
| --- | --- |
| **1** | The `root` attribute (default `true`) can be set to `false`. When `false`, the node index is created with only the content it contains, and is used only for nested aggregation (for example in a `mgnl:page`). This helps create a lighter full-text search index. |

### [](#_providing_excerpts_and_highlighting_search_results)Providing excerpts and highlighting search results

The `workspace.xml` file in each workspace enables highlighting in search results and the Jackrabbit HTML [excerpt provider](../../../RNs-6-4-3/Administration/Architecture/Workspaces/workspace-configuration/#_term_identification) class. The `workspace.xml` files are in `/<CATALINA_HOME>/webapps/<contextPath>/repositories/magnolia/workspaces/<workspace name>`.

Here’s the relevant extract from `workspace.xml` in the `contacts` workspace.

```xml
<!-- needed to highlight the searched term -->
<param name="supportHighlighting" value="true"/>
<!-- custom provider for getting an HTML excerpt in a query result with rep:excerpt() -->
<param name="excerptProviderClass" value="info.magnolia.jackrabbit.lucene.SearchHTMLExcerpt"/>
```

> **Tip:** If you have configured your own app that operates on its own workspace and provides content for the website, you need to add these parameters to the searchIndex element of your workspace.xml file to show excerpts and highlighting in Web search results.

> **Warning:** If you have used fields which allow for the storing of HTML, then that HTML will be indexed along with content. There is potential for the excerpt to contain HTML tags which are not closed.

| Node name | Value |
| --- | --- |
| ⸬ tours |  |
| ⬩ repository | tours |
| ⬩ handlePrefix |  |
| ⬩ URIPrefix | /tours/ |

## [](#_customizing_search)Customizing search

You can customize search by writing your own queries to search the index and execute them in code. A query returns a result set which you can display on a page.

Write queries in a language supported by the JCR repository such as SQL-2 ([grammar](http://www.h2database.com/jcr/grammar.html), [examples](http://svn.apache.org/viewvc/jackrabbit/trunk/jackrabbit-spi-commons/src/test/resources/org/apache/jackrabbit/spi/commons/query/sql2/test.sql2.txt?view=markup)).

You can test your queries in the [Query subapp](../../../RNs-6-4-3/Apps/List-of-apps/JCR-Tools-app/). When you get the result set you want, implement the query in code.

![Query subapp](../../../RNs-6-4-3/_images/6-0-JCR-tools-query-app.png)

### [](#_example_queries)Example queries

The following queries are written in SQL-2. See [JCR Query Cheat Sheet](../../../RNs-6-4-3/Developing/Development-how-tos/jcr-query-cheat-sheet/) for more examples.

1.  Find pages that contain the word `swiss`.

    Workspace: `website`

    ```sql
    SELECT * FROM [mgnl:page] AS t WHERE
       ISDESCENDANTNODE([/tours]) AND
       CONTAINS(t.*, 'swiss')
    ```


2.  Find modules that have [commands](../../../RNs-6-4-3/Developing/Commands/). This query looks for a folder named `commands` in the module configuration.

    Workspace: `config`

    ```sql
    SELECT * FROM [mgnl:content] AS t WHERE
       ISDESCENDANTNODE([/modules]) AND
       name(t) = 'commands'
    ```


3.  Find assets that are not JPG images under the `/example` path in the DAM.

    Workspace: `dam`

    ```sql
    SELECT * FROM [nt:base] AS t WHERE
       ([jcr:primaryType] = 'mgnl:asset' AND
       [type] <> 'jpg') AND
       ISDESCENDANTNODE([/example])
    ORDER BY [t].title asc
    ```


## [](#_security)Security

Search within Magnolia is access controlled. Search results include only content the user has permission to access. Permissions are controlled through [Security](../../../RNs-6-4-3/Administration/Security/). When you execute a query in info.magnolia.context.MgnlContext, contextual factors such as the current user’s permissions are taken into account. If you do not have permission to the items you are querying, they will not show up in the results.

## [](#_further_resources)Further resources

-   Apache.org

    -   [Jackrabbit - Search implementation](https://jackrabbit.apache.org/jcr/search-implementation.html)

    -   [Issues](https://issues.apache.org/jira/browse/JCR)



Related topics

-   [Solr search](../../../RNs-6-4-3/Features/Search/Solr-search/)

-   [Solr module](../../../RNs-6-4-3/Modules/List-of-modules/Solr-module/)

    -   [Installing Apache Solr](../../../RNs-6-4-3/Modules/List-of-modules/Solr-module/Installing-Apache-Solr/)

    -   [Indexing and crawling a website with Solr](../../../RNs-6-4-3/Modules/List-of-modules/Solr-module/Indexing-and-crawling-a-website-with-Solr/)

    -   [App configuration with Solr](../../../RNs-6-4-3/Modules/List-of-modules/Solr-module/App-configuration-with-Solr/)

    -   [Providing a Solr search](../../../RNs-6-4-3/Modules/List-of-modules/Solr-module/Providing-a-Solr-search/)
