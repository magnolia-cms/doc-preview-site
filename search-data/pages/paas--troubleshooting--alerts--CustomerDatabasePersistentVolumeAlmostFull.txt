---
title: "Database persistent volume is almost full"
url: https://docs.magnolia-cms.com/paas/troubleshooting/alerts/CustomerDatabasePersistentVolumeAlmostFull/
category: DX Cloud
version: cloud
breadcrumb: DX Cloud > Troubleshoot > Database persistent volume is almost full
---

# Database persistent volume is almost full

## [](#_symptom)Symptom

A `CustomerDatabasePersistentVolumeAlmostFull` alert is firing.

> **Note:** CustomerDatabasePersistentVolumeAlmostFull alerts are sent to subscribers via email.

| **Expression** | `(kubelet_volume_stats_available_bytes{persistentvolumeclaim=~"data.*"} / kubelet_volume_stats_capacity_bytes{persistentvolumeclaim=~"data.*"}) * 100 < 1` |
| --- | --- |
| **Delay** | `15` minutes |
| **Labels** | `team: customer` |
| **Annotations** | • `summary` • `description` • `tenant` • `cluster_id` • `cluster_name` • `namespace` • `pvc` |

## [](#_solutions)Solutions

This section provides a solution that should help resolve the issue in most cases.

1.  [Increase the capacity of the database persistent volume](#_increase_the_capacity_of_the_database_persistent_volume)

2.  [Increase capacity via Helm chart](#_increase_capacity_via_helm_chart)

3.  [Delete the `StatefulSet`](#_delete_the_statefulset)


### [](#_increase_the_capacity_of_the_database_persistent_volume)Increase the capacity of the database persistent volume

The space allocated to the Database persistent volume can be increased by editing the persistent volume in Rancher and by [modifying the values of the Helm chart](#_increase_capacity_via_helm_chart) deploying Magnolia.

You can edit the persistent volume claim and increase the capacity in Rancher or with `kubectl`.

Edit the persistent volume claim or the persistent volume associated with the claim and increase the size of the storage resource.

1.  Get your desired namespace.

    ```sh
    kubectl -n <namespace> get pvc <pvc-name>
    ```

2.  Edit the PVC.

    ```sh
    kubectl -n <namespace> edit pvc <pvc-name>
    ```

3.  In the editor, adjust the `storage`.

    ```yaml
      resources:
        requests:
          storage: 10Gi (1)
    ```

    |     |     |
    | --- | --- |
    | **1** | Increase the `storage` property. |

    > **Warning:** The storage resource for the persistent volume claim is not permanent. It may be overridden when Magnolia is redeployed with the Helm chart.


### [](#_increase_capacity_via_helm_chart)Increase capacity via Helm chart

Set the Helm chart value `db.persistence.size` to an appropriate value in your values.yml file.

> **Note:** The default value of db.persistence.size is 10Gi.

### [](#_delete_the_statefulset)Delete the `StatefulSet`

Because `StatefulSet` volume definitions cannot be updated in place, you must manually update them.

1.  Run the `kubectl` command to delete the statefulset.

    ```none
    kubectl delete statefulset <name> --cascade=orphan (1)
    ```

    |     |     |
    | --- | --- |
    | **1** | **Important**: The `--cascade=orphan` flag ensures running pods are not deleted. |

2.  Redeploy Magnolia.
