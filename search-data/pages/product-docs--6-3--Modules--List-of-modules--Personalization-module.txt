---
title: "Personalization module"
url: https://docs.magnolia-cms.com/product-docs/6.3/Modules/List-of-modules/Personalization-module/
category: Magnolia 6.3
version: 6.3
breadcrumb: DX Core > Modules > Personalization module
---

# Personalization module

[Personalization](../../../use-cases/Personalization/) Bundled: DX Core

| Edition | DX Core |
| --- | --- |
| License | [MLA](https://www.magnolia-cms.com/mla.html)<br><br>This module includes GeoLite2 data created by MaxMind, available from [www.maxmind.com](https://www.maxmind.com). |
| Issues | [MGNLPN](https://magnolia-cms.atlassian.net/browse/MGNLPN) |
| Maven site | [Personalization](https://nexus.magnolia-cms.com/#browse/browse:enterprise:info%2Fmagnolia%2Fpersonalization%2Fmagnolia-personalization-integration%2F3.0.6) |
| Latest | 3.0.6 |
| [Available on SPA/Headless](../../../Developing/Templating/Freemarker-vs-headless/#_magnolia_modules_and_features) | Yes |

## [](#_personalization)Personalization

[Personalization](../../../use-cases/Personalization/) refers to adapting content to a particular user according to his or her personal preferences, needs and capabilities. In order to do so, you first select a set of traits of a visitor or a visit, then compose rules using these traits to define what content is presented to which visitors and when.

## [](#_modules)Modules

Magnolia‚Äôs Personalization feature consists of the following modules.

-   Blossom-compatibility: Provides personalization of [Blossom](../Blossom-module/) components.

-   Compatibility: Provides the 5 UI framework modules.

-   Components: Support for creating component variants.

-   Core: Personalization core.

-   Integration: Personalization support for creating page [variants](../../../Getting-started-with-Magnolia/Glossary/#_variant) and fields for selecting [traits](../../../Getting-started-with-Magnolia/Glossary/#_trait) and audiences.

    > **Note:** Since version 2.0, this submodule has been deprecated and its functions relocated to the Compatibility submodule.

-   Pages: Personalization integration for the Pages app.

-   Personas app: App for creating hypothetical visitors who represent your target audience.

-   [Preview app](../../../Apps/List-of-apps/Preview-app/): App for testing content delivery by impersonating a visitor.

-   REST: [Personalization support for the Delivery API](#3.1@rest:api:Requesting-personalized-content-with-the-delivery-endpoint.adoc).

-   Segmentation app: Provides the Segments app for grouping visitors into [segments](../../../Getting-started-with-Magnolia/Glossary/#_segment).

-   Traits: Example traits country, date, cookie and visitor.

-   Widgetset: Widgetset for client-side extensions needed for the variant-selectors.


```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-compatibility</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-components</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-core</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-integration</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-pages</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-personas-app</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-preview-app</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-rest</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-segmentation-app</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-traits</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

```xml
<dependency>
  <groupId>info.magnolia.personalization</groupId>
  <artifactId>magnolia-personalization-widget</artifactId>
  <version>3.0.6</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

Part of the module is also the `magnolia-personalization-blossom-compatibility`.

> **Caution:** To be able to use personalization in the Delivery API, you should:

1.  Add the Blossom dependency (`magnolia-personalization-blossom-compatibility`) only **if you are using the Blossom modules in your project**:

    ```xml
    <dependency>
      <groupId>info.magnolia.personalization</groupId>
      <artifactId>magnolia-personalization-blossom-compatibility</artifactId>
      <version>3.0.6</version> (1)
    </dependency>
    ```

    |     |     |
    | --- | --- |
    | **1** | Should you need to specify the module version, do it using `<version>`. |

2.  Make sure that in the content of your `pom.xml` for your webapp you include the following two dependencies **if your project is generated from the [Magnolia webapp archetype](../../../Developing/Development-how-tos/How-to-use-Magnolia-Maven-archetypes/)**:

    ```xml
    ...
      <dependencies>
       ...

       <!-- include p13n for rest -->
        <dependency>
            <groupId>info.magnolia.personalization</groupId>
            <artifactId>magnolia-personalization-rest</artifactId>
            <version>2.1.1</version>
        </dependency>

      </dependencies>
    ...
    ```

    > **Caution:** If you use personalization version 2.1.0, you also need to add the following dependencyManagement into your webapp‚Äôs pom.xml file....
    > <dependencyManagement>
    >     <dependencies>
    >     <!-- include dependency management for p13n 2.1.0 -->
    >         <dependency>
    >             <groupId>info.magnolia.personalization</groupId>
    >             <artifactId>magnolia-personalization-parent</artifactId>
    >             <version>2.1.0</version>
    >             <type>pom</type>
    >             <scope>import</scope>
    >         </dependency>
    >     </dependencies>
    > </dependencyManagement>
    > ...


## [](#_configuration)Configuration

> **Tip:** See an overview of differences between FreeMarker and headless templating.

### [](#_variant_rendering_restrictions_on_public_instances)Variant rendering restrictions on public instances

In Personalization module 3.0.4 (Magnolia 6.3.8) and later, a default rendering filter at `/server/filters/cms/rendering` blocks direct URL access to `mgnl:variant` nodes on public instances for security purposes, and returns a `404 not found` response. This means you can‚Äôt test variants using direct URLs.

To test, use the [Preview app](../../../Apps/List-of-apps/Preview-app/) or [enable traits as URL parameters](#_enabling_traits_as_url_parameters_on_the_public_instance) .

For more information, see [Restricting node type rendering](../../../Administration/Architecture/Request-processing-and-filters/Filters/#_restricting_node_type_rendering).

### [](#_components_submodule)Components submodule

Nested variants occur when a page variant contains component variants. Control the ability for editors to create nested variants using the `allowNestedVariants` property on the module level configuration.

| Node name | Value |
| --- | --- |
| personalization-components |     |
| config |     |
| allowNestedVariants | false |

| Property | Description |
| --- | --- |
| `allowNestedVariants` | **optional**, *default is `false`*<br><br>Allows you to create component variants inside a page variant if set to `true`. |

### [](#_traits_submodule)Traits submodule

Provides out-of-the-box functionality for the following trait types:

-   All name-and-value based traits.

-   Cookie trait.

-   Header trait.

-   Request parameter trait.


### [](#_compatibility_submodule)Compatibility submodule

The `magnolia-personalization-compatibility` submodule provides the following pre-configured trait types, inherited from the older (pre-2.1) versions of the Personalization module:

-   Date

-   Country

-   Visitor

-   Cookies


## [](#_custom_traits)Custom traits

Each trait has a configuration which can be adjusted. For configuration details, see the [Registering a trait](Creating-custom-traits/#_registering_a_trait) section on Creating custom traits page.

## [](#_enabling_traits_as_url_parameters_on_the_public_instance)Enabling traits as URL parameters on the public instance

In Personalization module 3.0.4 and later, previewing traits as URL parameters on the public instance is disabled for security purposes.

> **Tip:** You can still preview traits as URL parameters on the author instance.

If you want to test variant delivery on the public instance, you must enable it first. You can enable it through decoration or in the Configuration app.

If you do both, the decoration takes precedence over the Configuration app settings due to Magnolia‚Äôs [resource loading order](#6.2@product-docs:ROOT:Developing/Resources.adoc#_origins_and_loading_order).

**Decoration**

1.  [Decorate](#6.2@product-docs:ROOT:Developing/Definition-decoration.adoc) the [Preview app](#6.2@product-docs:ROOT:Apps/List-of-apps/Preview-app.adoc) under `/<light-module>/decorations/personalization-preview-app/config.yaml`.

2.  Set `previewFilter` to `true`.

    config.yaml

    ```yaml
    previewFilter: true
    ```


**Configuration app**

1.  Open the Configuration app and go to `/server/filters/preview`.

2.  Add a property named `enabled` and set it to `true`.


|     |     |
| --- | --- |
| üìÅ server |     |
| üìÅ filters |     |
| üìÅ preview |     |
| ‚¨© class | info.magnolia.personalization.preview.filter.PreviewFilter |
| ‚¨© enabled | true |

Once enabled, you can pass traits as parameters in the URL on the public instance. This is a handy way to test scenarios that would otherwise be difficult to reproduce such as requesting the page from a Chinese IP address.

Use the following format:

```bash
http://example.com?<previewParameterPrefix><Parameter>=<value>
```

|     |     |
| --- | --- |
| `previewParameterPrefix` | Identifies the parameter as a preview parameter. Parameters used for personalization have a special prefix that sets them apart from other parameters. The default prefix is `preview`, for example `previewPersona` or `previewCountry`. You can configure the prefix string `/modules/personalization-preview-app/config/previewParameterPrefix`. |
| `<Parameter>` | Name of the parameter with first letter capitalized, for example `Country` or `Date`. |
| `<value>` | Parameter value in a valid format. The format depends on the parameter. For the country trait the value is a two-letter country code (`gb`, `cn`) and for a date it is a timestamp written as `yyyy-mm-dd-hh-mm-ss` such as `2019-05-26-00-00-00`). |

**Example**: Visitor from China on May 26, 2019:

```none
http://localhost:8080/magnoliaPublic/travel/festivals.html?previewCountry=cn&previewDate=2019-05-26-00-00-00
```

![The image of the Dragon Boat Festival a visitor from China on May 26, 2019 sees](../../../_images/public-china.png)

## [](#_issues)Issues

### [](#_missing_countryvoter)Missing CountryVoter

You may encounter the following issue:

```console
2024-09-18 15:30:30,533 WARN  agnolia.transformer.ClassPropertyBasedTypeResolver: Encountered the 'class' property but failed to resolved the type from its value: [info.magnolia.personalization.geoip.CountryVoter]
java.lang.ClassNotFoundException: info.magnolia.personalization.geoip.CountryVoter
```

**Solution**

1.  Add the following dependency to your webapp:

    ```xml
      <dependency>
            <groupId>info.magnolia.personalization</groupId>
            <artifactId>magnolia-personalization-compatibility</artifactId>
            <version>${personalization.version}</version>
      </dependency>
    ```

2.  If needed, copy the related configuration from `/modules/personalization-traits`.


Related topics

-   [Personalization](../../../use-cases/Personalization/)

-   [Component personalization](../../../Features/Personalization/Component-personalization/)

-   [Requesting personalized content with the delivery endpoint](#3.1@rest:api:Requesting-personalized-content-with-the-delivery-endpoint.adoc)

-   [Personalization of headless SPA projects](../../../Developing/headless/spa-development/personalization-of-headless-SPA-projects/)

-   [Preview app](../../../Apps/List-of-apps/Preview-app/)

-   [My first personalized campaign](My-first-personalized-campaign/)

-   [Creating custom traits](Creating-custom-traits/)

-   [Creating custom traits without Java](Creating-custom-traits-without-Java/)

-   [Creating custom traits with complex fields](Creating-custom-traits-with-complex-fields/)
