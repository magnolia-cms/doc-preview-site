---
title: "Filters"
url: https://docs.magnolia-cms.com/product-docs/6.3/Administration/Architecture/Request-processing-and-filters/Filters/
category: Magnolia 6.3
version: 6.3
breadcrumb: DX Core > Administration > Architecture > Request processing and filters > Filters
---

# Filters

[Java filters](http://www.oracle.com/technetwork/java/filters-137243.html) were introduced in the Java Servlet specification version 2.3. A filter intercepts requests and responses to transform or use the information. Filters typically don‚Äôt create responses themselves but instead provide universal functions that can be `attached` to any type of servlet page.

Since the filter chain is responsible for request handling in Magnolia, the default chain illustrates how filters are used to process requests. This page provides minimal information on filters. For more information, see [Request processing and filters](../../../../../RNs-6-4-3/Administration/Architecture/Request-processing-and-filters/) and the `filters` package.

> **Caution:** Don‚Äôt change the filter orderMagnolia handles incoming requests to display a page through its own filter chain. Filters in the chain are executed in the order in which they are declared until a filter decides that it can fulfill the request.Be carefulWhen editing properties in the filter chain be careful. Always test the changes on test environment before applying it to production.For instance, if you add a info.magnolia.voting.Voter to a filter with an erroneous regular expression, you won‚Äôt be able to access AdminCentral anymore. In such a case, you have to use the Groovy Rescue app.

## [](#_context)Context

The first filter in the filter chain is the info.magnolia.cms.filters.ContextFilter. This filter initializes `MgnlContext` and configures [MDC logging](http://www.javacodegeeks.com/2013/01/effective-logging-in-javajee-mapped-diagnostic-context.html). `MgnlContext` is local to the request and available on every further filter. The context provides a lot of useful functions, see info.magnolia.context.MgnlContext for details.

## [](#_content_type)Content type

The job of the `ContentTypeFilter` is to initialize info.magnolia.cms.core.AggregationState.

It‚Äôs created and populated with:

-   Character encoding

-   Original URI

-   Original URL

-   Extension

-   Query string


The `AggregationState` is accessible using `MgnlContext.getAggregationState()`.

The `Content-Type` header is not set by `ContentTypeFilter` anymore. The MIME type was incorrectly set according to the request extension. It is now the responsibility of renderers/servlets to set the correct content type. For instance, info.magnolia.rendering.renderer.FreemarkerRenderer sets the content type.

Content type filter can be configured to [match requests to content types](../../../../../RNs-6-4-3/Administration/MIME-type-mapping/#_matching_requests_to_content_types). See [Restricting responses to configured MIME types](../../../../../RNs-6-4-3/Administration/MIME-type-mapping/#_restricting_responses_to_configured_mime_types).

## [](#_cookies_detector)Cookies detector

info.magnolia.personalization.cookie.CookiesDetectorFilter is a [personalization](../../../../../RNs-6-4-3/use-cases/Personalization/) filter that detects request cookies and adds them as traits to the aggregation state.

## [](#_date)Date

info.magnolia.personalization.date.system.DateDetectorFilter is a simple date [trait](../../../../../RNs-6-4-3/use-cases/Personalization/) filter for [personalization](../../../../../RNs-6-4-3/use-cases/Personalization/) that stores the current system time in the `TraitCollector`.

## [](#_country)Country

info.magnolia.personalization.geoip.CountryDetectorFilter is a GeoIP [trait](../../../../../RNs-6-4-3/use-cases/Personalization/) filter that detects the user‚Äôs country using the IP address of the request for [personalization](../../../../../RNs-6-4-3/use-cases/Personalization/). It adds the country to the aggregation state as a trait. If a GET parameter `Country#REQUEST_PARAMETER` with an IP address is supplied, this address is used to resolve the country, which is stored in the `TraitCollector`.

| Property | Description |
| --- | --- |
| `httpOnlyCookie` | **optional** , *default is true* A security setting that prevents cookies from being read by potentially malicious code. |
| `secureCookie` | **optional** , *default is not set* Determines whether the CSRF cookie is marked as secure. Default behavior (when not set): The secure flag mirrors the security of an incoming request. The cookie is only marked as secure if the request is received over HTTPS. This behavior is consistent with how a container handles session cookies. Explicit control: ‚Ä¢ Set to `true` to always mark the cookie as secure. ‚Ä¢ Set to `false` to prevent the cookie from being marked as secure. This property can also be configured in the `magnolia.properties` file using `magnolia.cookie.csrf.secure` . For example, to force secure cookies regardless of the request protocol: magnolia.properties `magnolia.cookie.csrf.secure=true` |
| `sameSite` | **optional** , *default is Strict* Controls whether cookies are sent with cross-site requests to protect against cross-site attacks. Valid values: ‚Ä¢ `Strict` sends cookies only for same-site requests. They aren‚Äôt sent, for example, when a user follows an external link to the origin site. ‚Ä¢ `Lax` sends cookies for same-site requests and when following a link to the origin site. ‚Ä¢ `None` sends cookies in both first-party and cross-origin requests. ‚Ä¢ `Omitted` omits the `SameSite` attribute from the cookie entirely. |

| üìÅ server |  |
| --- | --- |
| üìÅ filters |  |
| üìÅ multipartRequest |  |
| ‚¨© class | info.magnolia.cms.filters.MultipartRequestFilter |
| ‚¨© fileCountMax | 100 |
| ‚¨© maxFileSize | 2000000000 |

## [](#_unicode_normalization)Unicode Normalization

info.magnolia.cms.filters.UnicodeNormalizationFilter normalizes the current URI to the NFC form that is used internally.

## [](#_registration)Registration

info.magnolia.enterprise.registration.RegistrationFilter checks the validity of the registration of a DX Core installation and delegates to the registration form so that the user can enter the license key. The license is also checked in other parts of the code.

> **Note:** If you need to remove the X-Magnolia-Registration header added by this filter, do it at the level of a proxy, load balancer, or CDN.

## [](#_login)Login

info.magnolia.cms.security.auth.login.LoginFilter handles incoming login requests and delegates to [login handlers](../../../../../RNs-6-4-3/Administration/Architecture/Request-processing-and-filters/Login-handlers/). The handlers are configured under this filter.

The Login filter verifies that user credentials are authenticated so that only authenticated users can be made into active users. Magnolia uses [JAAS](http://en.wikipedia.org/wiki/Java_Authentication_and_Authorization_Service) for authentication. For more information, see [Security](../../../../../RNs-6-4-3/Administration/Security/).

> **Important:** Redirecting via the mgnlReturnTo request parameter after login is only permitted for relative URLs or for URLs explicitly added to the info.magnolia.cms.security.auth.login.LoginFilter configuration.To whitelist URLs, add the UrlPattern instances of all allowed redirects to server/filter/login/allowedRedirects.

## [](#_gzip)GZip

To improve site performance, info.magnolia.module.cache.filter.GZipFilter replaces text type responses with the gzipped response. This filter passes a `ResponseWrapper` instead of the response object it got in the `doFilter(..)` call to the filter chain. After all the following filters have been executed, content is extracted from the `ResponseWrapper`, gzipped and written to the original response.

## [](#_channel)Channel

info.magnolia.cms.filters.MultiChannelFilter resolves the channel to use by considering variations of the set channel. The resulting site gets set in info.magnolia.module.site.ExtendedAggregationState.

## [](#_multisite)Multisite

info.magnolia.multisite.filters.MultiSiteFilter is a DX Core filter. It detects which site definition should be used. The filter makes site-related properties available in info.magnolia.cms.core.AggregationState.

## [](#_trusted_proxy_headers)Trusted proxy headers

info.magnolia.module.site.filters.TrustedProxyHeadersFilter is a CE and DX Core servlet filter used to enforce security policies on HTTP requests based on headers commonly used by proxies.

```yaml
server:
  filters:
...
    trustedProxyHeaders:
      class: info.magnolia.module.site.filters.TrustedProxyHeadersFilter
      jcr:primaryType: mgnl:content
      enabled: true (1)
...
```

|     |     |
| --- | --- |
| **1** | Default filter setting is `false`. It disables the filter, no header checking is done. |

### [](#_configuration)Configuration

The filter allows you to configure permitted header values and can enforce these policies based on whether forwarding through a proxy is enabled or disabled.

-   If *enabled*, it checks whether the incoming request headers match the allowed values. If a header does not match the allowed values, the request is blocked.

-   If *disabled*, the presence of any configured headers in the request will cause the request to be blocked since their presence is unexpected.


`TrustedProxyHeadersFilter` reads configuration from a site configuration. Each site can have a specific configuration. For configuration details, see the `trustedProxyConfig` node description in [Site module: Configuration](#2.0@site:ROOT:index.adoc#_configuration).

## [](#_site_merge)Site merge

info.magnolia.module.site.filters.SiteMergeFilter merges channel variations with the site definition. Configurations under this filter override configuration done in the site definition. The filter sets the site definition in the aggregation state.

In the Community Edition, this filter sets the site in the aggregation state. In DX Core, the multisite filter can also set the site.

## [](#_logout)Logout

info.magnolia.cms.security.LogoutFilter checks to see if the logout attribute `mgnlLogout` is set as a request parameter. If this flag is found, the user is logged out and the filter chain restarts with the first filter.

## [](#_security_callback)Security callback

info.magnolia.cms.security.SecurityCallbackFilter handles 401 and 403 HTTP response codes and `AccessDeniedExceptions`. The filter renders an appropriate `login form` that can consist of a redirect or anything else.

Multiple `HttpClientCallbacks` with different configuration and behavior can be configured for this filter.

Here is the client callback configuration for the Travel Demo members area redirect and login form.

/server/filters/securityCallback/

```yml
class: info.magnolia.cms.security.SecurityCallbackFilter
clientCallbacks:
  travel-demo-pur:
    class: info.magnolia.cms.security.auth.callback.RedirectClientCallback
    location: /travel/members/login.html
    originalUrlPattern:
      class: info.magnolia.cms.util.SimpleUrlPattern
      patternString: (*|travel)/members/(profile-update|protected)*
  form:
    class: info.magnolia.cms.security.auth.callback.FormClientCallback
    loginForm: /defaultMagnoliaLoginForm/login.html
```

> **Warning:** Both callback classes implement the info.magnolia.cms.security.auth.callback.HttpClientCallback interface and support their own configuration properties. A custom callback should implement this interface.

Classes

-   info.magnolia.cms.security.auth.callback.FormClientCallback renders a login form using FreeMarker and the template configured with `loginForm`.

-   info.magnolia.cms.security.auth.callback.RedirectClientCallback redirects to a configured path or URL. This is useful, for example, in a single sign-on (SSO) context where the login screen is handled by a different application, or to hide the login form from a public instance using a fronting server configuration.

    #### Redirection of *unauthorized* and *forbidden* requests to `404`

    Using the `sendError` property in the `RedirectClientCallback`, you can redirect `401` and `403` errors to a specific error page.

    With the following example configuration, the login form will only be displayed when `/.magnolia/admincentral` is requested. All the other unauthorized requests are redirected to the default `404` page.

    /server/filters/securityCallback/

    ```yml
    clientCallbacks:
      form:
        originalUrlPattern:
          class: info.magnolia.cms.util.SimpleUrlPattern
          patternString: /.magnolia/admincentral
        class: info.magnolia.cms.security.auth.callback.FormClientCallback
        loginForm: /defaultMagnoliaLoginForm/login.html
      redirectUnauthorized:
        class: info.magnolia.cms.security.auth.callback.RedirectClientCallback
        sendError: 404
    ```

    > **Note:** It is the container itself that handles the redirect to the appropriate error page through the <error-code> configuration.

-   info.magnolia.cms.security.auth.callback.AbstractHttpClientCallback provides a number of filtering capabilities:

    -   `url`. Current request URL decoded and without the context path.

    -   `urlPattern`

    -   `originalUrl`. Original request URL decoded and without the context path, but not modified by any filter.

    -   `originalUrlPattern`

    -   `hostPattern`

    -   `voters`

        For example, in a [multisite](../../../../../RNs-6-4-3/Developing/Templating/Site-definition/How-to-use-Multisite/) installation for the request [`http://demo.magnolia-cms.com/travel/about.html`](http://demo.magnolia-cms.com/travel/about.html):

    -   `url` is `/about.html`

    -   `originalUrl` is `/travel/about.html`

        The Multisite filter removes the first-level node name from the URL.

        > **Tip:** The methods provided by AbstractHttpClientCallback are also provided by the info.magnolia.cms.util.UrlPatternDelegate utility class.



| Property | Description |
| --- | --- |
| `<voter node>` | **required** Voter node. Name the node, for example, `whitelist` . |
| `class` | **required** Fully qualified voter class name. Available classes: ‚Ä¢ info.magnolia.voting.voters.RequestHeaderPatternSimpleBoolVoter checks for a URL pattern that complies with info.magnolia.cms.util.SimpleUrlPattern (for example, `http://www.example.*` ). ‚Ä¢ info.magnolia.voting.voters.RequestHeaderPatternRegexBoolVoter checks for a regular expression pattern. |
| `headerName` | **required** Header you want to check (for example, `referer` ). ** The [spelling of the word referer is intentional](http://en.wikipedia.org/wiki/HTTP_referer#Origin_of_the_term_referer) . | ** | The [spelling of the word referer is intentional](http://en.wikipedia.org/wiki/HTTP_referer#Origin_of_the_term_referer) . |
| ** | The [spelling of the word referer is intentional](http://en.wikipedia.org/wiki/HTTP_referer#Origin_of_the_term_referer) . |
| `pattern` | **required** Domain or URL pattern that complies with info.magnolia.cms.util.SimpleUrlPattern . The pattern must be present in the header for the filter to be bypassed. |

| Node name | Value |
| --- | --- |
| üìÅ ipSecurity |  |
| ‚¨© class | info.magnolia.cms.security.IPSecurityFilter |

## [](#_cross_site_security)Cross-site security

info.magnolia.multisite.filters.CrossSiteSecurityFilter grants or denies permission to a site when the site is requested through a particular domain name. When a user tries to access one site‚Äôs content through another site‚Äôs domain name, the system displays a HTTP 404 error (page not found). See [Cross-site security](../../../Security/Cross-site-security/)

| Node name | Value |
| --- | --- |
| ‚∏¨ form |  |
| ‚¨© class | info.magnolia.cms.security.auth.callback.FormClientCallback |
| ‚¨© loginForm | /defaultMagnoliaLoginForm/login.html |

## [](#_range)Range

info.magnolia.cms.filters.RangeSupportFilter adds support for ranged requests. Ranged requests are used by iPhone and some other clients to stream videos. In contrast to Android phones, iPhone doesn‚Äôt support any other method of streaming videos.

## [](#_i18n_content_support)i18n content support

info.magnolia.cms.i18n.I18nContentSupportFilter detects the requested locale and sets the locale in the aggregation state. The filter rewrites the internal current URI, whether virtual or not. It doesn‚Äôt rewrite the URI displayed to the user, however. For more information, see [Language](../../../../../RNs-6-4-3/Administration/Language/).

## [](#_cache)Cache

info.magnolia.module.cache.filter.CacheFilter manages the Magnolia cache.

The cache filter checks if a requested resource is already stored in the cache to avoid recreation of the resource. If the resource is in the cache, then it‚Äôs written to the response and the filter chain stops. If the resource is not found in the cache, then a `ResponseWrapper`, which not only writes to the `standard` response but also saves the response, is passed to the chain. After the filters that follow have been executed (and the requested resource created), the content is extracted from the response wrapper and stored in the cache.

The cache filter is part of [Cache core](../../../../../RNs-6-4-3/Modules/List-of-modules/Cache-modules/Cache-core/) and the respective configuration is in the module configuration.

## [](#_cors)CORS

info.magnolia.cors.SelfConfiguredCorsFilter and info.magnolia.module.site.filters.SiteAwareCorsFilter (Magnolia 6.2.4+) handle simple and pre-flight requests for cross-origin resource sharing (CORS). For more details, see the [CORS](../../../../../RNs-6-4-3/Administration/Architecture/Request-processing-and-filters/CORS/) page.

## [](#_content_security_policy_csp)Content Security Policy (CSP)

The CSP filter adds the `Content-Security-Policy` header to the response, helping prevent Cross-Site Scripting (XSS) and other code-injection attacks. For more details, see [Content-Security-Policy (CSP) Filter](../csp/).

## [](#_virtual_uri)Virtual URI

info.magnolia.virtualuri.VirtualUriFilter checks if the requested URI matches a configured URI pattern and executes the [URI mapping](../../../../../RNs-6-4-3/Administration/URI-mapping/).

## [](#_servlets_filter_chain)Servlets filter chain

The servlets configured in modules are installed in Magnolia‚Äôs servlets filter chain using info.magnolia.cms.filters.ServletDispatchingFilter as the implementing filter class. If the servlet mapping matches the URI, then the `service(..)` method of the servlet is called. See [Registering a servlet](../../../../../RNs-6-4-3/Administration/Architecture/Request-processing-and-filters/Registering-a-servlet/) for more.

| Target | Information collected |
| --- | --- |
| Page | * Content node of the requested page * Template |
| NodeData | * `NodeData` object of the requested data * Template if a template is connected with the `NodeData` |

## [](#_restricting_access_to_resources)Restricting access to resources

Access to resources is defined in the `/modules/resources/config/resourceFilter` filter. By default, the filter allows access to resources as follows:

-   `byType`

    -   `css, map, js, htm(l), ico, woff(2), ttf, svg, gif, jp(e)g, tiff, bmp`


-   `byLocation`

    -   when located in the `webresources` directory.



| üìÅ server |  |
| --- | --- |
| üìÅ filters |  |
| üìÅ HeaderFilterOne |  |
| ‚¨© class | info.magnolia.cms.filters.AddHeadersFilter |
| ‚¨© enabled | true |
| üìÅ headers |  |
| ‚¨© Access-Control-Allow-Headers | X-Requested-With, Content-Type, Accept |
| ‚¨© Access-Control-Allow-Methods | GET |
| ‚¨© Access-Control-Allow-Origin | * |

## [](#_custom_filters)Custom filters

If you need a custom filter, see [Custom filters](../../../../../RNs-6-4-3/Administration/Architecture/Request-processing-and-filters/Custom-filters/).
