---
title: "SSO module"
url: https://docs.magnolia-cms.com/magnolia-sso/3.1/
category: Modules
version: modules
breadcrumb: SSO module
---

# SSO module

| Edition | DX Core |
| --- | --- |
| License | [MLA](https://www.magnolia-cms.com/mla.html) |
| Issues | [MGNLSSO](https://magnolia-cms.atlassian.net/browse/MGNLSSO) |
| Maven site | [SSO](https://nexus.magnolia-cms.com/#browse/browse:enterprise:info%2Fmagnolia%2Fsso%2Fmagnolia-sso%2F3.1.10) |
| Latest | 3.1.10 |

## [](#_installing_with_maven)Installing with Maven

Maven is the easiest way to install the module. Add the following to your [bundle](../../product-docs/RNs-6-4-3/Developing/Bundles-and-webapps/):

```xml
<dependency>
  <groupId>info.magnolia.sso</groupId>
  <artifactId>magnolia-sso</artifactId>
  <version>3.1.10</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

| Prerequisite | Description |
| --- | --- |
| a user | **required** Its username and password are used to access Admincentral. It should have names as well as an email. |
| a group | **required** When the user logs in, it has to belong to at least one group defined in the group mappings. That’s how the necessary access to Magnolia is granted. ** A user may only belong to a maximum number of 200 groups, including nested groups, for JSON web tokens (JWT). For more information, see [Microsoft group overages](https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles#group-overages) . | ** | A user may only belong to a maximum number of 200 groups, including nested groups, for JSON web tokens (JWT). For more information, see [Microsoft group overages](https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles#group-overages) . |
| ** | A user may only belong to a maximum number of 200 groups, including nested groups, for JSON web tokens (JWT). For more information, see [Microsoft group overages](https://learn.microsoft.com/en-us/security/zero-trust/develop/configure-tokens-group-claims-app-roles#group-overages) . |
| an OIDC client | **required** With the following properties: |
| a name | **required** Must be the same as the one used in the YAML configuration of the module. |
| the `openid-connect` protocol | **required** |
| a confidential access type | **required** This is required to generate credentials. |
| credentials | **required** Those must be shared with the YAML configuration of the module. |
| a redirect URI | **required** That points back to Magnolia, e.g. `http://localhost:8080/*` . |
| a Group Membership mapper | **required** By convention, this is required in order to include the user’s groups in the `groups` property ( info.magnolia.sso.oidc.GroupsAuthorizationGenerator ). Without this data, a user won’t be assigned any Magnolia permission, and hence won’t be able to go past the login screen. Here’s how to configure the mapper in various applications: • []() Okta • []() Azure • []() Keycloak ** If you leave **Full group path** toggle **On** as shown below, make sure it’s reflected in your [yaml configuration](#sso-yamlConfig-authGeneratorSection) as the path ( `/group-name` , not just `group-name` ). Otherwise, toggle this option to **Off** and use the group name. | ** | If you leave **Full group path** toggle **On** as shown below, make sure it’s reflected in your [yaml configuration](#sso-yamlConfig-authGeneratorSection) as the path ( `/group-name` , not just `group-name` ). Otherwise, toggle this option to **Off** and use the group name. |
| ** | If you leave **Full group path** toggle **On** as shown below, make sure it’s reflected in your [yaml configuration](#sso-yamlConfig-authGeneratorSection) as the path ( `/group-name` , not just `group-name` ). Otherwise, toggle this option to **Off** and use the group name. |

## [](#_sso_user_profile_information)SSO user profile information

User profile preferences related to the Magnolia instance for SSO users is stored in the `profiles` workspace that may only be accessed by the `superuser`.

The following information is stored in the `profiles` workspace for SSO users:

-   Favorite apps

-   Language

-   Last login

-   Previous login

-   Timezone

-   Completed intro status (Magnolia app launcher tour)

-   Usage metrics acknowledgement status


> **Tip:** SSO users can set their user preferences for timezone and language in AdminCentral.

The information for each user is stored based on the username from the third-party IdP. If you change a user’s username in your IdP, their preferences are reset in Magnolia.

| Callout | Description |
| --- | --- |
| `path` | **Required** Describes on which path the SSO module should kick in. `/.magnolia/admincentral` is the default for most cases. |
| `callbackUrl` | **Required** The URL of Magnolia’s callback servlet. This URL is made up of the instance’s absolute URL (in this case, `http://localhost:8080` ) as well as the relative path to `SSOCallbackServlet` , which is `/.auth` by default. Since SSO Module `1.1.1` , if the supplied `callbackUrl` is a relative path, it is automatically prefixed with the instance’s `defaultBaseUrl` property. This requires the property to be properly defined in the first place. All users including `anonymous` must have access to `/.auth` . From SSO module 2.0.3, this is possible by assigning users the `sso-redirect-uri-authorizer` role. |
| `postLogoutRedirectUri` | **Optional** The URI to where the user is returned after logging out. If the property is not defined, it falls back to the user’s current URL. This **must be** an absolute URL. Property defined : Jane is working on `http://localhost:8080/.magnolia/admincentral` and she logs out. Jane is redirected to `http://localhost:8080/.magnolia/admincentral/logout` . Property not defined : Jane is working on `http://localhost:8080/.magnolia/admincentral` and she logs out. Jane is redirected back to `http://localhost:8080/.magnolia/admincentral` . ** If you want to configure the Magnolia SSO module to add the `client_id` to this redirect logout URL, you can use custom code to extend the info.magnolia.sso.SsoLogoutFilter . Generally, you can achieve this by overwriting the `doFilter` and adding the logic, for example, within `getPostLogoutUrl` function. That way, you can dynamically retrieve the `client_id` and add it. ** SSO version 4.0 has the [Configuring multiple SSO clients](../guides/configuring-multiple-sso-clients/) feature, which allows you to use multiple SSO configurations in one Magnolia instance without changing any code. | ** | If you want to configure the Magnolia SSO module to add the `client_id` to this redirect logout URL, you can use custom code to extend the info.magnolia.sso.SsoLogoutFilter . Generally, you can achieve this by overwriting the `doFilter` and adding the logic, for example, within `getPostLogoutUrl` function. That way, you can dynamically retrieve the `client_id` and add it. | ** | SSO version 4.0 has the [Configuring multiple SSO clients](../guides/configuring-multiple-sso-clients/) feature, which allows you to use multiple SSO configurations in one Magnolia instance without changing any code. |
| ** | If you want to configure the Magnolia SSO module to add the `client_id` to this redirect logout URL, you can use custom code to extend the info.magnolia.sso.SsoLogoutFilter . Generally, you can achieve this by overwriting the `doFilter` and adding the logic, for example, within `getPostLogoutUrl` function. That way, you can dynamically retrieve the `client_id` and add it. |
| ** | SSO version 4.0 has the [Configuring multiple SSO clients](../guides/configuring-multiple-sso-clients/) feature, which allows you to use multiple SSO configurations in one Magnolia instance without changing any code. |
| `authorizationGenerators` | **Required** A list of configured authorization generators as part of a specified client. Currently, we support both Fixed and Group authorization. After defining these here, you need to call them in the [clients:](#sso-clients-description) field in this `config.yaml` file. • []() Groups generator • []() Fixed role generator This generator should be used when different security levels in the IDP should be mapped to equivalent Magnolia roles and groups. Given a user’s groups on a third-party IAM management instance, the generator maps the group(s) to one or multiple Magnolia roles. The following example maps the the IDP `superusers` group to the Magnolia group `publishers` with the Magnolia role `superuser.` `authorizationGenerators: - name: groupsAuthorization groups: targetProperty: groups mappings: - name: superusers targetGroups: - publishers targetRoles: - superuser` ** When working with Azure Active Directory, group IDs ( *rather than names* ) must be used. To increase transparency, add the actual group’s name as a comment. See the following example. `authorizationGenerators: groups: targetProperty: groups mappings: - name: ea0b1d9f-c8fc-4b99-9f76-8a92abbbb496: # sysadmins targetRoles: - …` The fixed role generator gives all users the same permissions. `authorizationGenerators: - name: fixedRoleAuthorization fixed: targetRoles: - superuser targetGroups: - publishers` ** This generator shouldn’t be used in production but it can be a good starting point for settings things up or where group mappings aren’t possible. For instance, with Google Cloud, where manual verification of the application must happen before the user’s groups can be queried. | ** | When working with Azure Active Directory, group IDs ( *rather than names* ) must be used. To increase transparency, add the actual group’s name as a comment. See the following example. | ** | This generator shouldn’t be used in production but it can be a good starting point for settings things up or where group mappings aren’t possible. For instance, with Google Cloud, where manual verification of the application must happen before the user’s groups can be queried. |
| ** | When working with Azure Active Directory, group IDs ( *rather than names* ) must be used. To increase transparency, add the actual group’s name as a comment. See the following example. |
| ** | This generator shouldn’t be used in production but it can be a good starting point for settings things up or where group mappings aren’t possible. For instance, with Google Cloud, where manual verification of the application must happen before the user’s groups can be queried. |
| `clients` | **Required** A set of properties for different clients (Oidc and DirectBearerAuthClient with `oidc` and `http.bearer` prefix respectively). This is where you define the client IDs, secrets, and scopes. You can enter multiple clients here as shown in the example. Each client requires a `name` , `secret` , `clientAuthenticationMethod` , `scope` , `discoveryUri` , `authorizationGenerators` and `authenticator` (only requires for Pac4j’s DirectBearerAuthClient with `http.bearer` properties prefix) as shown below. ** You can define multiple clients of the same type by adding a number at the end of the properties: `oidc.id.2` , `http.bearer.id.2` . `http.bearer` client []() An `http.bearer` client can be configured to support a use case like getting resources or content from Magnolia via REST calls with Bearer authentication. Check out the Okta concepts docs for more details: [Resource Owner Password flow](https://developer.okta.com/docs/concepts/oauth-openid/#resource-owner-password-flow) and [Client Credentials flow](https://developer.okta.com/docs/concepts/oauth-openid/#saml-2-0-assertion-flow) . Find out more in [Pac4j Clients concepts](https://www.pac4j.org/docs/clients.html#1-direct-vs-indirect-clients) . `clients: http.bearer.id: 0oa1imrwonnyHpIvI0x7 http.bearer.secret: aKzLmsj...tIL8HKkh6 http.bearer.clientAuthenticationMethod: client_secret_basic http.bearer.scope: openid profile email http.bearer.discoveryUri: https://YOUR_URI/oauth2/aus...0x7/.well-known/openid-configuration http.bearer.preferredJwsAlgorithm: RS256 http.bearer.authorizationGenerators: fixedRoleAuthorization http.bearer.authenticator: oidc-userinfo` oidc client field description `id` The client ID. You get this from your OIDC provider configuration. `secret` The client secret. You get this from your OIDC provider configuration. `clientAuthenticationMethod` Defines how the client credentials (client ID and secret) are passed to the token endpoint. Supported methods (values): • `client_secret_basic` • `client_secret_post` • `private_key_jwt` `scope` Defines the user data that the Magnolia instance should be allowed to request from OIDC. ** The `openid` , `profile` , and `email` scopes are mandatory in order for Magnolia to create a user account with basic information about the user. For users that implement refresh tokens with Azure, you can add the `offline_access` scope as well. `discoveryUri` The IAM instance’s auth endpoint URL. ** This must be tweaked according to your project. `authorizationGenerators` Defines the authorization generator names to use for the client. This includes custom authorization generators as well as fixed and/or group authorization generators. Refer to the name of your configured authorization generators. ** You can define multiple authorization generators separated by commas, e.g.,: `groupsAuthorization, editorGroupsAuthorization` . If you want a custom generator, follow the steps [here](guides/custom-auth-generators/) . `authenticator` The HTTP clients require that you define an **Authenticator** to handle the credentials validation. ** This property is required for the `http.bearer` properties prefix only. It only supports **2** authenticators. Possible values for this property are: `oidc-userinfo` and `token-introspection` . • `oidc-userinfo` : This [UserInfoOidcAuthenticator](https://www.javadoc.io/doc/org.pac4j/pac4j-oidc/latest/org/pac4j/oidc/credentials/authenticator/UserInfoOidcAuthenticator.html) is provided by Pac4j which authenticates the request with a Bearer Token using the Oidc `UserInfo` endpoint. • `token-introspection` : This implementation of `Authenticator` will authenticate the request with a Bearer Token using the Token Introspection endpoint. Please note that some Identity providers (IdP) do not support the Token Introspection endpoint, please make sure it is fully supported before configuring this authenticator. | ** | You can define multiple clients of the same type by adding a number at the end of the properties: `oidc.id.2` , `http.bearer.id.2` . | oidc client field | description | `id` | The client ID. You get this from your OIDC provider configuration. | `secret` | The client secret. You get this from your OIDC provider configuration. | `clientAuthenticationMethod` | Defines how the client credentials (client ID and secret) are passed to the token endpoint. Supported methods (values): • `client_secret_basic` • `client_secret_post` • `private_key_jwt` | `scope` | Defines the user data that the Magnolia instance should be allowed to request from OIDC. ** The `openid` , `profile` , and `email` scopes are mandatory in order for Magnolia to create a user account with basic information about the user. For users that implement refresh tokens with Azure, you can add the `offline_access` scope as well. | ** | The `openid` , `profile` , and `email` scopes are mandatory in order for Magnolia to create a user account with basic information about the user. For users that implement refresh tokens with Azure, you can add the `offline_access` scope as well. | `discoveryUri` | The IAM instance’s auth endpoint URL. ** This must be tweaked according to your project. | ** | This must be tweaked according to your project. | `authorizationGenerators` | Defines the authorization generator names to use for the client. This includes custom authorization generators as well as fixed and/or group authorization generators. Refer to the name of your configured authorization generators. ** You can define multiple authorization generators separated by commas, e.g.,: `groupsAuthorization, editorGroupsAuthorization` . If you want a custom generator, follow the steps [here](guides/custom-auth-generators/) . | ** | You can define multiple authorization generators separated by commas, e.g.,: `groupsAuthorization, editorGroupsAuthorization` . If you want a custom generator, follow the steps [here](guides/custom-auth-generators/) . | `authenticator` | The HTTP clients require that you define an **Authenticator** to handle the credentials validation. ** This property is required for the `http.bearer` properties prefix only. It only supports **2** authenticators. Possible values for this property are: `oidc-userinfo` and `token-introspection` . • `oidc-userinfo` : This [UserInfoOidcAuthenticator](https://www.javadoc.io/doc/org.pac4j/pac4j-oidc/latest/org/pac4j/oidc/credentials/authenticator/UserInfoOidcAuthenticator.html) is provided by Pac4j which authenticates the request with a Bearer Token using the Oidc `UserInfo` endpoint. • `token-introspection` : This implementation of `Authenticator` will authenticate the request with a Bearer Token using the Token Introspection endpoint. Please note that some Identity providers (IdP) do not support the Token Introspection endpoint, please make sure it is fully supported before configuring this authenticator. | ** | This property is required for the `http.bearer` properties prefix only. It only supports **2** authenticators. Possible values for this property are: `oidc-userinfo` and `token-introspection` . |
| ** | You can define multiple clients of the same type by adding a number at the end of the properties: `oidc.id.2` , `http.bearer.id.2` . |
| oidc client field | description |
| `id` | The client ID. You get this from your OIDC provider configuration. |
| `secret` | The client secret. You get this from your OIDC provider configuration. |
| `clientAuthenticationMethod` | Defines how the client credentials (client ID and secret) are passed to the token endpoint. Supported methods (values): • `client_secret_basic` • `client_secret_post` • `private_key_jwt` |
| `scope` | Defines the user data that the Magnolia instance should be allowed to request from OIDC. ** The `openid` , `profile` , and `email` scopes are mandatory in order for Magnolia to create a user account with basic information about the user. For users that implement refresh tokens with Azure, you can add the `offline_access` scope as well. | ** | The `openid` , `profile` , and `email` scopes are mandatory in order for Magnolia to create a user account with basic information about the user. For users that implement refresh tokens with Azure, you can add the `offline_access` scope as well. |
| ** | The `openid` , `profile` , and `email` scopes are mandatory in order for Magnolia to create a user account with basic information about the user. For users that implement refresh tokens with Azure, you can add the `offline_access` scope as well. |
| `discoveryUri` | The IAM instance’s auth endpoint URL. ** This must be tweaked according to your project. | ** | This must be tweaked according to your project. |
| ** | This must be tweaked according to your project. |
| `authorizationGenerators` | Defines the authorization generator names to use for the client. This includes custom authorization generators as well as fixed and/or group authorization generators. Refer to the name of your configured authorization generators. ** You can define multiple authorization generators separated by commas, e.g.,: `groupsAuthorization, editorGroupsAuthorization` . If you want a custom generator, follow the steps [here](guides/custom-auth-generators/) . | ** | You can define multiple authorization generators separated by commas, e.g.,: `groupsAuthorization, editorGroupsAuthorization` . If you want a custom generator, follow the steps [here](guides/custom-auth-generators/) . |
| ** | You can define multiple authorization generators separated by commas, e.g.,: `groupsAuthorization, editorGroupsAuthorization` . If you want a custom generator, follow the steps [here](guides/custom-auth-generators/) . |
| `authenticator` | The HTTP clients require that you define an **Authenticator** to handle the credentials validation. ** This property is required for the `http.bearer` properties prefix only. It only supports **2** authenticators. Possible values for this property are: `oidc-userinfo` and `token-introspection` . • `oidc-userinfo` : This [UserInfoOidcAuthenticator](https://www.javadoc.io/doc/org.pac4j/pac4j-oidc/latest/org/pac4j/oidc/credentials/authenticator/UserInfoOidcAuthenticator.html) is provided by Pac4j which authenticates the request with a Bearer Token using the Oidc `UserInfo` endpoint. • `token-introspection` : This implementation of `Authenticator` will authenticate the request with a Bearer Token using the Token Introspection endpoint. Please note that some Identity providers (IdP) do not support the Token Introspection endpoint, please make sure it is fully supported before configuring this authenticator. | ** | This property is required for the `http.bearer` properties prefix only. It only supports **2** authenticators. Possible values for this property are: `oidc-userinfo` and `token-introspection` . |
| ** | This property is required for the `http.bearer` properties prefix only. It only supports **2** authenticators. Possible values for this property are: `oidc-userinfo` and `token-introspection` . |
| `userFieldMappings` | **Required** Authentication services use different attribute names for user information. Because of this, it is necessary to map the retrieved response to a standard set of user attributes used within the SSO module. This contains key-value pair mappings where the `key` is the property name which will be stored within the properties of Magnolia’s `info.magnolia.cms.security.ExternalUser` and the `value` is the attribute name in the OIDC profile. ** If the identity provider does not return a name attribute in the OIDC profile, Magnolia deduces it from the `email` attribute by excluding the domain. Where `fabien@example.com` becomes `fabien` . | ** | If the identity provider does not return a name attribute in the OIDC profile, Magnolia deduces it from the `email` attribute by excluding the domain. Where `fabien@example.com` becomes `fabien` . |
| ** | If the identity provider does not return a name attribute in the OIDC profile, Magnolia deduces it from the `email` attribute by excluding the domain. Where `fabien@example.com` becomes `fabien` . |

## [](#_configure_jaas)Configure JAAS

The instance’s [JAAS security setup](#6.2@product-docs:ROOT:Administration/Security/JAAS-security-setup.adoc) must be edited and only contain the following:

JAAS configuration

```java
sso-authentication {
  info.magnolia.sso.jaas.SsoAuthenticationModule requisite;
  info.magnolia.jaas.sp.jcr.JCRAuthorizationModule required;
};
```

| Module version | Third-party APIs tested against |
| --- | --- |
| `3.1.5+` | Keycloak `21.1.0` ** See [here](https://www.keycloak.org/2023/04/keycloak-2110-released) for more on Keycloak `21.1.0` . | ** | See [here](https://www.keycloak.org/2023/04/keycloak-2110-released) for more on Keycloak `21.1.0` . |
| ** | See [here](https://www.keycloak.org/2023/04/keycloak-2110-released) for more on Keycloak `21.1.0` . |
| `3.1+` | Keycloak `21.0.1` ** See [here](https://www.keycloak.org/2023/03/keycloak-2101-released) for more on Keycloak `21.0.1` . | ** | See [here](https://www.keycloak.org/2023/03/keycloak-2101-released) for more on Keycloak `21.0.1` . |
| ** | See [here](https://www.keycloak.org/2023/03/keycloak-2101-released) for more on Keycloak `21.0.1` . |
| `3.0+` | Keycloak `16.1.1` ** See [here](https://www.keycloak.org/2022/01/keycloak-1611-released) for more on Keycloak `16.1.1` . | ** | See [here](https://www.keycloak.org/2022/01/keycloak-1611-released) for more on Keycloak `16.1.1` . |
| ** | See [here](https://www.keycloak.org/2022/01/keycloak-1611-released) for more on Keycloak `16.1.1` . |
| `2.0+` | Azure Active Directory ** We exclusively support the 2.0 version of the endpoint. This means the URL should look like `https://login.microsoftonline.com/…/v2.0/.well-known/openid-configuration` . | ** | We exclusively support the 2.0 version of the endpoint. This means the URL should look like `https://login.microsoftonline.com/…/v2.0/.well-known/openid-configuration` . |
| ** | We exclusively support the 2.0 version of the endpoint. This means the URL should look like `https://login.microsoftonline.com/…/v2.0/.well-known/openid-configuration` . |
| `2.0+` | Google Cloud Identity |
| `1.1+` | Keycloak 9.0.3 |
| `1.1+` | Okta 2021.03.3+ |
