---
title: "Migrate from DAM 4 JCR-based storage to DAM 6"
url: https://docs.magnolia-cms.com/dam/migrate/migrate-jcr-to-dam/
category: Modules
version: modules
breadcrumb: DAM module > Migrate > Migrate from a JCR-based implementation to DAM 6
---

# Migrate from DAM 4 JCR-based storage to DAM 6

This page explains how to migrate from DAM module 4.x, which stores all assets in the `dam` JCR workspace, to DAM module 6.x.

In DAM 6.x, you can choose to store both asset *metadata* and *binaries* in JCR, or to externalize binary storage to S3 or Azure Blob storage.

> **Tip:** Migration is optional when storing assets in JCR with DAM 6. The migration process updates existing assets with a property introduced in DAM 5 (mgnlBinaryReference). This property is added to all assets, regardless of storage choice, uploaded when using DAM 6.

| DAM module version | Compatible module versions |
| --- | --- |
| 6.0.0 | Magnolia CMS 6.4.0+ |
| [DAM App module](../../../dam-app/) 6.0.0 (required) |
| [Imaging module](../../../imaging/) 5.0.0 (required) |
| [Image Recognition extension](../../../image-recognition/) 4.0.0 (optional) |
| [Image Focal extension](../../../image-focal/) 2.0.0 (optional) |

## [](#_migrate_assets_from_dam_4_to_dam_6)Migrate assets from DAM 4 to DAM 6

Edit and run the `migrateAssets` Groovy script provided below on your author instance to migrate binaries.

*Only if migrating to external binary storage*, you may also run the `removeBinariesFromJcr` to remove from JCR any binaries that have been successfully migrated.

### [](#_step_1_migrate_assets)Step 1: Migrate assets

1.  Open the Groovy app in your Magnolia author instance.

2.  Copy the `migrateAssets` Groovy script below to the **Groovy Console** tab.

3.  Edit the script to point to your chosen destination.

    The options are:

    1.  `"jcr"`: Store both asset *metadata* and *binaries* in JCR.

    2.  `"s3"`: Store asset *metadata* in JCR and *binaries* in AWS S3.

    3.  `"azure-blob"`: Store asset *metadata* in JCR and *binaries* in Azure Blob storage.

        > **Tip:** To see low-level S3 activity during migration, enable DEBUG logging for the AWS SDK. In your Logback configuration, add: <logger name="software.amazon" level="DEBUG"/>


4.  Run the script.

    This script copies binaries from JCR to the destination chosen and logs a summary of what was migrated.

    You can run it multiple times. It skips already-migrated binaries and only processes the remaining ones. It does not remove anything from JCR.

    MigrateAssets.groovy

    ```groovy
    import info.magnolia.dam.jcr.migration.AssetMigration
    import info.magnolia.dam.jcr.migration.MigrationConfig
    import info.magnolia.dam.jcr.migration.MigrationUtils
    import info.magnolia.objectfactory.Components

    def startTime = System.currentTimeMillis()
    def service = Components.getComponent(AssetMigration) ?: {
        println "Error: Asset migration script not found."
        return
    }()

    // Define provider
    def provider = "s3" // "s3", "jcr" or "azure-blob" (1)

    // default build config, parallel processing
    def config = MigrationConfig
            .builder(provider)
    // .sequential(true)  (2)
            .build()

    def results = service?.migrateAll(config) ?: {
        println "Info: No asset migrations needed."
        return
    }()

    print(MigrationUtils.printSummary(results, startTime))
    ```

    |     |     |
    | --- | --- |
    | **1** | Specify the target for binary storage: `"jcr"`, `"s3"`, or `"azure-blob"`. |
    | **2** | The migration script processes assets in chunks and in parallel by default. Uncomment the `.sequential(true)` line in the configuration only to force sequential processing. |

5.  Review the script output to confirm migration results.

6.  Run the script again if needed. It only processes binaries that haven’t yet been migrated.


### [](#_optional_step_2_only_if_using_external_binary_storage_remove_binaries_from_jcr)Optional step 2: Only if using external binary storage - remove binaries from JCR

> **Caution:** Don’t follow this step if using JCR to store your binaries.

After all binaries are copied to S3 or Azure Blob, run the `removeBinariesFromJcr` script to delete them from JCR. The script only deletes binaries that were successfully migrated to external storage. Others remain untouched.

1.  Open the Groovy app in your Magnolia author instance.

2.  Copy the `removeBinariesFromJcr` Groovy script below to the **Groovy Console** tab and run it.

    RemoveBinariesFromJCR.groovy

    ```groovy
    import info.magnolia.dam.jcr.migration.AssetMigration
    import info.magnolia.objectfactory.Components

    def startTime = System.currentTimeMillis()
    def service = Components.getComponent(AssetMigration) ?: {
        println "Error: JcrToDam5BinaryMigration not found. Cannot proceed with JCR binary deletion."
        return
    }()

    def results = service?.removeBinariesFromJcr()
    if (!results) {
        println "Info: No binary data deletions needed."
        return
    }

    def totalSpaceFreed = results.stream()
            .filter { it.success() }
            .mapToLong { it.size() }
            .sum()

    def spaceMessage = "JCR Binary Deletion = total space freed up: " + AssetMigration.formatBytes(totalSpaceFreed)
    println spaceMessage

    print(service.printSummary(results, startTime))
    ```

3.  Check that assets and any pages using the assets work correctly.
