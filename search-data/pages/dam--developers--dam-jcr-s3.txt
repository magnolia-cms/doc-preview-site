---
title: "Configure the DAM JCR S3 submodule"
url: https://docs.magnolia-cms.com/dam/developers/dam-jcr-s3/
category: Modules
version: modules
breadcrumb: DAM module > JCR S3 submodule
---

# Configure the DAM JCR S3 submodule

To store asset binaries in S3, configure the DAM JCR S3 module to connect Magnolia to your AWS S3 bucket. Asset metadata is stored in the [`dam` JCR workspace](../dam-workspace/).

To configure the module, you must:

-   Install the required module versions.

-   Set up AWS IAM policy permissions.

-   Provide connection credentials for AWS S3.


## [](#_prerequisites)Prerequisites

Make sure you have at least the following modules installed:

-   [`dam` `6.0.0`](../install/), including the `dam-jcr-s3` submodule

-   [`dam-app` `6.0.0`](#dam-app:ROOT:developers/install.adoc)

-   [`imaging` `5.0.0`](#imaging:ROOT:developers/install.adoc)

-   Optional: [`image-recognition` `4.0.0`](#image-recognition:ROOT:developers/install.adoc)


## [](#_aws_iam_policy)AWS IAM Policy

Make sure that you have acquired appropriate permissions for the service in the [AWS IAM Management Console](https://console.aws.amazon.com/iam/home?region=us-east-2#/users).

![AWS IAM Policy](../../../product-docs/7.0/_images/aws-aim-console-users-focus-blur.png)

### [](#_minimum_required_permissions)Minimum required permissions

To use Magnolia DAM with AWS S3, the following permissions are required.

-   `s3:GetObject`

-   `s3:PutObject`

-   `s3:DeleteObject`

-   `s3:HeadObject`

-   `s3:CopyObject`


For more information about these permissions, see the Amazon documentation [Actions defined by Amazon S3](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazons3.html#amazons3-actions-as-permissions) page.

> **Note:** Your S3 bucket must have versioning enabled. For more information, see the Amazon documentation Enabling versioning on buckets page.

Policy example

```javascript
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowS3Operations",
            "Effect": "Allow",
            "Action": [ (1)
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:HeadObject",
                "s3:CopyObject",
            ],
            "Resource": "*"
        }
    ]
}
```

|     |     |
| --- | --- |
| **1** | Grant access for the S3 bucket and object-level permissions. |

## [](#_configure_the_dam_jcr_s3_module)Configure the `dam-jcr-s3` module

1.  Stop Magnolia.

2.  Provide the following required properties, either in your `WEB-INF/config/default/magnolia.properties` file or using [MicroProfile Config](#product-docs:ROOT:Administration/Architecture/configuration-management/microprofile-config/):

    magnolia.properties

    ```bash
    dam.core.binary.strategy=s3 (1)
    dam.core.binary.s3.bucket-name=<your-S3-bucket-name> (2)
    dam.core.binary.s3.region=<your-s3-region> (3)
    dam.core.binary.s3.access-key=<your-access-key> (4)
    dam.core.binary.s3.secret-key=/<your-secret-key> (4)
    dam.core.binary.s3.endpoint=<optional-url> (5)
    dam.core.binary.s3.aws-profile=<optional-aws-profile-name> (6)
    ```

    |     |     |
    | --- | --- |
    | **1** | The binary storage strategy you want to implement, in this case `s3` (note the lower case s). |
    | **2** | The name of the S3 bucket where you store your asset binaries. Make sure the bucket you use has [versioning enabled](https://docs.aws.amazon.com/AmazonS3/latest/userguide/manage-versioning-examples.html). |
    | **3** | A label designating a regional endpoint to which the image recognition service connects, such as `eu-central-1`. For a list of available regions and labels, see [AWS: Regional endpoints](https://docs.aws.amazon.com/general/latest/gr/rande.html#regional-endpoints). |
    | **4** | Specific AWS credentials. See the [AWS credentials](#_aws_credentials) section below. |
    | **5** | You can specify a custom endpoint in case you are using a compatible AWS S3 provider. |
    | **6** | Optional AWS profile to use when connecting to S3. See the [AWS credentials](#_aws_credentials) section below. |

    > **Tip:** You can inject these values using MicroProfile Config, which supports environment variables, or JVM system properties` file.

3.  Restart Magnolia.


### [](#_aws_credentials)AWS credentials

Credentials consist of:

-   AWS access key ID

-   AWS secret access key


You can provide specific [AWS credentials](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html) to connect AWS to Magnolia DAM.

magnolia.properties

```bash
dam.core.binary.s3.access-key=<your-access-key>
dam.core.binary.s3.secret-key=/<your-secret-key>
```

To generate keys, go to the the security credentials section of the [Amazon IAM Management Console](https://console.aws.amazon.com/iam/home?region=us-east-2#/users). In the navigation bar on the upper right, choose your user name, and then choose **My Security Credentials**.

If you donâ€™t provide them, the DAM defaults to global AWS environment credentials.

```bash
aws.accessKeyId (or AWS_ACCESS_KEY_ID environment variable)
aws.secretAccessKey (or AWS_SECRET_ACCESS_KEY environment variable)
```

### [](#_aws_profile)AWS profile

You can also configure DAM to use an AWS named profile instead of explicit access and secret keys.

magnolia.properties

```bash
dam.core.binary.s3.aws-profile=<your-aws-profile-name>
```

When `dam.core.binary.s3.aws-profile` is provided, Magnolia uses the credentials from that AWS profile to connect to S3. If `dam.core.binary.s3.aws-profile` is not provided, Magnolia uses the `dam.core.binary.s3.access-key` and `dam.core.binary.s3.secret-key` properties.

## [](#_avoid_editing_assets_on_public_instances_when_using_s3)Avoid editing assets on public instances when using S3

Editing or replacing assets on a public instance can corrupt S3 binaries. Always make changes on the author instance.

When S3 binary storage is enabled, updating or replacing an asset on a public instance deletes the asset binaries and leaves the asset in a broken state. Subsequent publication from the author instance propagates this corrupted state to public instances.

Ensure all asset changes are made on the author instance and published. Consider restricting access to the Assets app on public instances to prevent accidental edits.
