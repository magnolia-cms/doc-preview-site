---
title: "Advanced Cache Policies module"
url: https://docs.magnolia-cms.com/product-docs/7.0/Modules/List-of-modules/Advanced-cache-modules/Advanced-Cache-Policies-module/
category: Magnolia 6.4
version: latest
breadcrumb: DX Core > Modules > Advanced cache modules > Advanced Cache Policies module
---

# Advanced Cache Policies module

| Edition | DX Core |
| --- | --- |
| License | [MLA](https://www.magnolia-cms.com/mla.html) |
| Issues | [MGNLADVCACHE](https://magnolia-cms.atlassian.net/browse/MGNLADVCACHE) |
| Maven site | [Advanced Cache](https://nexus.magnolia-cms.com/#browse/browse:enterprise:info%2Fmagnolia%2Fadvancedcache%2Fmagnolia-advanced-cache%2F{magnolia-advanced-cache-64}) |
| Latest | {magnolia-advanced-cache-64} |

## [](#_installing_with_maven)Installing with Maven

Maven is the easiest way to install the module. Add the following to your [bundle](../../../../../RNs-6-4-3/Developing/Bundles-and-webapps/):

```xml
<dependency>
  <groupId>info.magnolia.advancedcache</groupId>
  <artifactId>magnolia-advanced-cache</artifactId>
  <version>{magnolia-advanced-cache-64}</version> (1)
</dependency>
```

|     |     |
| --- | --- |
| **1** | Should you need to specify the module version, do it using `<version>`. |

## [](#_uninstalling)Uninstalling

To uninstall:

1.  Set the cache policy in `/modules/cache/config/contentCaching/defaultPageCache/cachePolicy@class` back to the default value `info.magnolia.module.cache.cachepolicy.Default`.

2.  Remove the `/modules/advanced-cache` node and its subnodes.

3.  Shut down Magnolia.

4.  Remove the Advanced Cache module `JAR` file (`magnolia-advanced-cache.jar`) from `WEB-INF/lib`.

5.  Start up Magnolia again.


## [](#_caching_strategies)Caching strategies

### [](#_serving_old_content_while_re_caching)Serving old content while re-caching

Using this strategy, the cache isn‚Äôt completely cleaned when content is updated and entries are retained. After the update, fresh cache entries are generated when the first page requests come in. All further requests for the same entry are then served from the old cache content until the new entry is ready.

-   Set `/modules/cache/config/contentCaching/defaultPageCache/cachePolicy@class` to `info.magnolia.module.advancedcache.ServeUntilRecachedCachePolicy`.

-   Set `/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/policies/flushAll@class` to `info.magnolia.module.advancedcache.NotifyFlushListeningPolicy`.


See also [Timestamp for last flushing](#_timestamp_for_last_flushing).

### [](#_eager_re_caching)Eager re-caching

Using this strategy, the cache stores the most frequently served entries. The system attempts to refresh these entries as soon as it detects a content update. All other entries are re-cached on request. You can configure the number of entries to re-cache immediately and set the lifetime of the most served content.

To enable eager re-caching:

-   Set `/modules/cache/config/contentCaching/defaultPageCache/cachePolicy@class` to `info.magnolia.module.advancedcache.EagerRecacheCachePolicy`.

-   Set `/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/flushAll@class` to `info.magnolia.module.advancedcache.EagerRecacheFlushPolicy`.

-   Set `/modules/cache/config/contentCaching/defaultPageCache/executors/store/cacheContent@class` to `info.magnolia.module.cache.executor.Store`.


#### [](#_changing_default_flush_policy)Changing default flush policy

By default, statistics about served pages are retained indefinitely. If you want to force the system to flush the cache after each content update:

1.  Create a `resetAfterUpdate` property node under `flushPolicy`.

2.  Set the value to `true`.


By default, the top 100 entries are eagerly re-cached on every update. To change that number:

1.  Create an `eagerRecache` property node under `flushPolicy`.

2.  Set the value to the number of top entries in the list you wish to have eagerly re-cached.


See also [Timestamp for last flushing](#_timestamp_for_last_flushing).

#### [](#_changing_default_waiting_time)Changing default waiting time

By default, Magnolia waits 10 seconds before attempting to re-cache after a content update. This timeout is controlled by the `blockingTimeout` property configured in the [Ehcache 3 back-end](../../../../../RNs-6-4-3/Modules/List-of-modules/Cache-modules/Ehcache-3-module/). The `blockingTimeout` property applies to the whole cache factory.

If you want to change the waiting time for a particular cache policy, add a `timeout` property with the number of milliseconds to wait (the default value is `10000`).

> **Warning:** Changes to cache policies and executors are applied immediately. Setting incorrect values can render the Magnolia instance inaccessible.If this happens, try the Groovy Rescue app:DX Core Groovy modulePaaS Rescue App

See also [Cache core module](../../../../../RNs-6-4-3/Modules/List-of-modules/Cache-modules/Cache-core/).

### [](#_timestamp_for_last_flushing)Timestamp for last flushing

The advanced flush policies update a `lastUpdateTimestamp` property to record the last flushing event. The timestamp allows the corresponding cache policy to identify which cache entries need to be regenerated. When you delegate cache to an advanced cache policy, create a property at a path that includes the name of your custom policy.

Example 1 - Serving old content while re-caching

-   `/modules/advanced-cache/config/notifyFlushListeningPolicy@lastUpdateTimeStamp` (default)

-   `/modules/advanced-cache/config/notifyFlushListeningPolicy/`**`<custom_cache_name>`**`@lastUpdateTimeStamp` (custom)


Example 2 - Eager re-caching

-   `/modules/advanced-cache/config/eagerRecacheFlushPolicy@lastUpdateTimeStamp` (default)

-   `/modules/advanced-cache/config/eagerRecacheFlushPolicy/`**`<custom_cache_name>`**`@lastUpdateTimeStamp` (custom)


In the examples above, `<custom_cache_name>` is the name of your custom policy.

## [](#_headless_personalization_and_caching)Headless personalization and caching

For headless personalization to work correctly with content caching in Magnolia, you have to set `/modules/cache/config/contentCaching/<your-configuration>/cachePolicy@includePersonalizedDescendants` to `true`.

By configuring this property, the [dynamic page-caching](../../../../../RNs-6-4-3/Modules/List-of-modules/High-performance-caching-modules/Advanced-Cache-Dynamic-Page-Caching/#_dynamic_page_caching) function is disabled.

> **Caution:** Magnolia does not currently support caching for different headers or cookies. Therefore, it is impossible to specify for which headers or cookies a response should be cached.See MGNLCACHE-245 for the upcoming improvement.

| üìÅ modules |  |
| --- | --- |
| üìÅ advanced-cache |  |
| üìÅ config |  |
| ‚¨© createSeparateCachesForEachSite | true |
