---
title: "solrfn"
url: https://docs.magnolia-cms.com/product-docs/Developing/Templating/Template-scripts/Templating-functions/solrfn/
category: Magnolia 6.4
version: latest
breadcrumb: DX Core > Developing > Templating > Template scripts > Templating functions > solrfn
---

# solrfn

[FreeMarker development only](../../../Renderers/#_renderers_provided_by_magnolia)

`solrfn` [templating functions](../) are used to construct search queries from FreeMarker templates and trigger [Solr](https://solr.apache.org) server searches that will return results in form of a [JSON](http://json.org/) string. Such results can be easily processed in FreeMarker templates.

These templating functions are provided by the `magnolia-solr-templating` submodule of the [Solr module](../../../../../Modules/List-of-modules/Solr-module/).

> **Note:** solrfn templating functions are not bundled with the preconfigured Magnolia bundles or webapps.

## [](#_basic_templating)Basic templating

All of the `solrfn` query methods are provided by the info.magnolia.search.solr.templating.SolrTemplatingFunction Java class and return a info.magnolia.search.solr.templating.SolrQueryBuilder object.

Calling one of its methods returns the same object and so you can chain the methods using the same object.

### [](#_create_a_query)Create a query

Create a Solr query.

#### [](#_method_signature)Method signature

`SolrQueryBuilder query(String searchTerm)`

`SolrQueryBuilder query(String searchTerm, boolean escape)`

#### [](#_arguments)Arguments

| Argument | Description |
| --- | --- |
| `searchTerm` | **required**<br><br>A term to search for. Leaving the argument unspecified will search for everything, which is the same as using the wildcard (`*`). |
| `escape` | **optional**<br><br>Escapes the [special characters](https://solr.apache.org/guide/solr/9_0/the-standard-query-parser.html#escaping-special-characters) in the search term if set to `true`. |

#### [](#_usage)Usage

`solrfn.query(searchTerm, escape)`

\[#assign results = solrfn.query("(1+1):2", true).search()\]

Creates a query for the mathematical expression `(1+1):2` and then triggers the search.

### [](#_trigger_a_search)Trigger a search

To trigger a search after initializing the `SolrQueryBuilder` by one of the query methods from the `SolrTemplatingFunction`, call the `search` method.

#### [](#_method_signature_2)Method signature

`String search()`

#### [](#_usage_2)Usage

`solrfn.query(searchTerm, escape).search()`

\[#assign results = solrfn.query("searchTerm").search()\]
${results}

Creates a query for "searchTerm", triggers the search and prints the whole JSON string.

To convert a string to a JSON expression, use the FreeMarker `[eval](https://freemarker.apache.org/docs/ref_builtins_expert.html#ref_builtin_eval)` function (`[eval_json](https://freemarker.apache.org/docs/ref_builtins_expert.html#ref_builtin_eval_json)` since freemarker 2.3.31), as in for example:

\[#assign results = solrfn.query("searchTerm").search()?eval\]

Documents found: ${results.response.numFound}

\[#list results.response.docs as doc\]
  <li>${doc.url!}
\[/#list\]

### [](#_use_a_different_solr_client)Use a different Solr client

The Solr Search Provider module allows you to define more than one server (see [Configuring Solr clients](../../../../../Modules/List-of-modules/Solr-module/Indexing-and-crawling-a-website-with-Solr/#_configuring_solr_clients)). To specify which Solr client should be leveraged, use the `clientName` method in the `SolrQueryBuilder`.

#### [](#_method_signature_3)Method signature

`SolrQueryBuilder clientName(String clientName)`

#### [](#_arguments_2)Arguments

| Argument | Description |
| --- | --- |
| `clientName` | **required**<br><br>Name of a configured Solr client. |

#### [](#_usage_3)Usage

`solrfn.query(searchTerm, escape).client(clientName).search()`

\[#assign results = solrfn.query("searchTerm").client("mySolrClient").search()\]

### [](#_filter_results_by_type)Filter results by type

Indexers and crawlers allow you to specify the type of content to be indexed, see the `type` property in [crawler and indexer configuration](../../../../../Modules/List-of-modules/Solr-module/Indexing-and-crawling-a-website-with-Solr/#_crawler_configuration). You can use the equivalent solrfn `type` method as a search filter.

#### [](#_method_signature_4)Method signature

`SolrQueryBuilder type(String type)`

#### [](#_arguments_3)Arguments

| Argument | Description |
| --- | --- |
| `type` | **required**<br><br>Name of the type. |

#### [](#_usage_4)Usage

`solrfn.query(searchTerm, escape).type(type).search()`

\[#assign results = solrfn.query("searchTerm").type("travel\_demo\_website").search()\]

## [](#_advanced_templating)Advanced templating

### [](#_common_parameters)Common parameters

`SolrQueryBuilder` provides several most commonly used Solr query parameters.

| Method | Description | Equivalent Solr parameter  <br>Link to Solr documentation |
| --- | --- | --- |
| `filterQuery(String…​ fq)` | Restrict query results. | `fq`<br><br>[Filter Query Parameter](https://solr.apache.org/guide/solr/9_0/common-query-parameters.html#fq-filter-query-parameter) |
| `start(Integer start)` | Sets an offset for a query result set and instructs Solr to display the results from this offset. | `start`<br><br>[Start Parameter](https://solr.apache.org/guide/solr/9_0/common-query-parameters.html#start-parameter) |
| `rows(Integer rows)` | Defines the maximum number of documents from a complete result set Solr should return.<br><br>Default value is `10`. | `rows`<br><br>[Rows Parameter](https://solr.apache.org/guide/solr/9_0/common-query-parameters.html#rows-parameter) |
| `field(String…​ fields)` | Limits the information included in a query response to a specified list of fields. | `fl`<br><br>[Field List Parameter](https://solr.apache.org/guide/solr/9_0/common-query-parameters.html#fl-field-list-parameter) |
| `sort(String…​ sorts)` | Arranges the search results in either ascending (*asc*) or descending (*desc*) order. | `sort`<br><br>[Sort Parameter](https://solr.apache.org/guide/solr/9_0/common-query-parameters.html#sort-parameter) |
| `defaultField(String field)` | Specifies a default field, overriding the default field in the Schema. | `df`<br><br>[Default Field Parameter](https://solr.apache.org/guide/solr/9_0/the-standard-query-parser.html#standard-query-parser-parameters) |

#### [](#_usage_5)Usage

\[#assign results = solrfn.query("searchTerm")
                                 .start(0)
                                 .size(50)
                                 .field("url, "name", "abstract")
                                 .filterQuery("category:mobile")
                                 .sort("inStock desc, price asc")
                                 .search()\]

### [](#_dismax_and_edismax_query_parsers)DisMax and eDisMax query parsers

By default, the [standard query parser](https://solr.apache.org/guide/solr/9_0/the-standard-query-parser.html) is used. To use the DisMax or the eDisMax filter instead, use the respective method.

| Method | Description | Link to Solr documentation |
| --- | --- | --- |
| `dismax()` | Use the DisMax parser. | [DisMax query parser](https://solr.apache.org/guide/solr/9_0/the-dismax-query-parser.html) |
| `edismax()` | Use the eDisMax parser. | [eDisMax query parser](https://solr.apache.org/guide/solr/9_0/the-extended-dismax-query-parser.html) |

#### [](#_parameters)Parameters

| Method | Description | Equivalent Solr parameter  <br>Link to Solr documentation |
| --- | --- | --- |
| `queryField(String…​ qf)` | Introduces a list of fields, each of which is assigned a boost factor to increase or decrease that particular field’s importance in the query. | `qf`<br><br>[Query Fields Parameter](https://solr.apache.org/guide/solr/9_0/the-dismax-query-parser.html#qf-query-fields-parameter) |
| `minimumMatch(String mm)` | By default, all words or phrases specified in the query are treated as "optional" clauses. The *mm* parameter makes it possible to say that a certain minimum number of those clauses must match. | `mm`<br><br>[Minimum Should Match](https://solr.apache.org/guide/solr/9_0/the-dismax-query-parser.html#mm-minimum-should-match-parameter) |
| `phraseField(String…​ pf)` | To "boost" the score of documents in cases where all of the terms in the query appear in close proximity. | `pf`<br><br>[Phrase Fields](https://solr.apache.org/guide/solr/9_0/the-dismax-query-parser.html#pf-phrase-fields-parameter) |
| `boostQuery(String…​ bq)` | Specifies an additional, optional, query clause that will be added to the user’s main query to influence the score. | `bq`<br><br>[Boost Query Parameter](https://solr.apache.org/guide/solr/9_0/the-dismax-query-parser.html#bq-boost-query-parameter) |

#### [](#_usage_6)Usage

\[#assign results = solrfn.query("searchTerm")
                                 .dismax()
                                 .queryField("title^10", "abstract^2", "content^0.5")
                                 .minimumMatch(2)
                                 .boostQuery("date:\[NOW/DAY-1YEAR TO NOW/DAY\]")
                                 .search()\]

### [](#_specifying_a_requesthandler)Specifying a requestHandler

A [request handler](https://solr.apache.org/guide/solr/9_0/requesthandlers-and-searchcomponents-in-solrconfig.html) processes incoming Solr requests. Multiple requestHandlers can be defined in the `solrConfig.xml`.

#### [](#_method_signature_5)Method signature

`SolrQueryBuilder requestHandler(String requestHandler)`

#### [](#_arguments_4)Arguments

| Argument | Description |
| --- | --- |
| `requestHandler` | **required**, *default is `/select`*<br><br>Specifies which request handler should be used in the Solr configuration. |

#### [](#_usage_7)Usage

\[#assign suggests = solrfn.query("searchTerm").requestHandler("/suggest").search()\]

### [](#_higlighting)Higlighting

Highlighting allows you to include with the query response fragments of documents that match the user’s query.

> **Note:** Fragments (also referred to as snippets or passages) are a portion of a document field that contains matches from the query.

The fragments are included in the *highlighting* section, a special section of the response, and the client uses the formatting clues also included to determine how to present the fragments to users.

See also [Common Highlighting Parameters](https://solr.apache.org/guide/solr/9_0/highlighting.html#common-highlighter-parameters) in Apache Solr documentation.

| Method | Description | Equivalent Solr parameter |
| --- | --- | --- |
| `highlight()` | Enables highlighting. | `hl=true` |
| `highlight(String…​ fields)` | Enables highlighting and specifies a list of fields to highlight. | `hl=true`<br><br>`hl.fl` |
| `highlightSnippets(int hlSnippets)` | Specifies the maximum number of highlighted snippets to generate per field. | `hl.snippets` |
| `highlightTag(String hlPre, String hlPost)` | Specifies a tag that will be used before and after a highlighted term. | `hl.simple.pre`<br><br>`hl.simple.post` |
| `highlightFragSize(int hlFragSize)` | Specifies the approximate fragment size to consider for highlighting.<br><br>The default size is *100* characters. | `hl.fragsize` |

#### [](#_usage_8)Usage

\[#assign results = solrfn.query("searchTerm")
                                 .highlight("title, content")
                                 .highlightTag("<h1>", "</h1>")
                                 .search()\]

### [](#_faceting)Faceting

Faceting is the arrangement of search results into categories based on indexed terms. It makes it easy for users to explore search results, narrowing in on exactly the results they are looking for.

Searchers are presented with the indexed terms, along with numerical counts of how many matching documents were found for each term.

See also [Field-Value Faceting Parameters](https://solr.apache.org/guide/solr/9_0/faceting.html#field-value-faceting-parameters) in Apache Solr documentation.

| Method | Description | Equivalent Solr parameter |
| --- | --- | --- |
| `facet()` | Enables faceting. | `facet=true` |
| `facetField(String…​ facetFields)` | Identifies a field that should be treated as a facet. | `facet.field` |
| `facetPrefix(String prefix)` | Limits the terms on which to facet to those starting with the given string prefix. | `facet.prefix` |
| `facetPrefix(String field, String prefix)` | For a specific field, limits the terms on which to facet to those starting with the given string prefix. | `f.<field>.facet.prefix` |
| `facetContains(String contains)` | Limits the terms on which to facet to those containing the given substring. | `facet.contains` |
| `facetContains(String field, String contains)` | For a specific field, limits the terms on which to facet to those containing the given substring. | `f.<field>.facet.contains` |
| `facetContains(String contains, boolean ignoreCase)` | Limits the terms on which to facet to those containing the given substring and allows case to be ignored when matching the given substring against candidate facet terms. | `facet.contains`<br><br>`facet.contains.ignoreCase` |
| `facetContains(String field, String contains, boolean ignoreCase)` | For specific field, limits the terms on which to facet to those containing the given substring and allows case to be ignored when matching the given substring against candidate facet terms. | `f.<field>.facet.contains`<br><br>`f.<field>.facet.contains.ignoreCase` |
| `facetLimit(int limit)` | Specifies the maximum number of facets for a field that are returned.<br><br>The default value is *100*. | `facet.limit` |
| `facetLimit(String field, int limit)` | For specific field, specifies the maximum number of facets for a field that are returned. | `f.<field>.facet.limit` |
| `facetSort(boolean index)` | If set to *true*, returns the constraints sorted in their index order.<br><br>If set to *false*, returns the constraints sorted by count.<br><br>The default is *count* if the facet limit is greater than *0*, otherwise, the default is *index*. | `facet.sort` |
| `facetSort(String field, boolean index)` | Same as the `facetSort(boolean index)` method, but only for a specific field. | `f.<field>.facet.sort` |
| `facetMinCount(int minCount)` | Specifies the minimum counts required for a facet field to be included in the response.<br><br>The default value is *0*. | `facet.mincount` |

#### [](#_usage_9)Usage

\[#assign results = solrfn.query("searchTerm")
                                 .facet()
                                 .facetField("category", "brand")
                                 .facetSort("category", true)
                                 .facetMinCount(5)
                                 .search()\]

### [](#_range_faceting)Range faceting

You can use range faceting on any date field or any numeric field that supports range queries.

See also [Range Facet Parameters](https://solr.apache.org/guide/solr/9_0/faceting.html#range-faceting) in Apache Solr documentation.

| Method | Description | Equivalent Solr parameter |
| --- | --- | --- |
| `facetRange(String field, String start, String end, String gap)` | Defines the field for which Solr should create range facets, with parameters `start`, `end` and `gap`. | `facet.range`<br><br>`f.<field>.facet.range.start`<br><br>`f.<field>.facet.range.end`<br><br>`f.<field>.facet.range.gap` |

#### [](#_usage_10)Usage

\[#assign results = solrfn.query("searchTerm")
                                  .facetRange("price", "0", "100000", "1000")
                                  .search()\]

### [](#_other_parameters)Other parameters

Solr provides many more options. If a function is missing in `solrfn`, then use the methods below.

| Method | Description | Equivalent Solr parameter |
| --- | --- | --- |
| `param(String param, String…​ values)` | Any parameter supported by Solr. | `<param>=<values>` |
| `param(String field, String param, String…​ values)` | Any parameter supported by Solr on a per field basis. | `f.<field>.<param>=<values>` |
